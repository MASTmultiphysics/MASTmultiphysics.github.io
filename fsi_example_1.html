<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>MAST: Panel flutter using V-g solver and Euler aerodynamics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MAST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fsi_example_1.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Panel flutter using V-g solver and Euler aerodynamics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#fluid_init">Initialize Fluid Solver</a></li>
<li class="level1"><a href="#structural_init">Initialize Structural Solver</a></li>
<li class="level1"><a href="#flutter_init">Initialize Flutter Solver</a></li>
<li class="level1"><a href="#solution">Solution</a><ul><li class="level2"><a href="#modal_sol">Structural Modal Solution</a></li>
<li class="level2"><a href="#flutter_sol">Flutter Solution</a></li>
<li class="level2"><a href="#plot_flutter">Plot Flutter Solution</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This example solves for the flutter speed of a semi-infinite (2D) panel with</p>
<p>Initialize libMesh library. </p><div class="fragment"><div class="line">libMesh::LibMeshInit init(argc, argv);</div></div><!-- fragment --><p> initialize the wrapper to read input parameters. This will check if the executable parameters included a parameter of type <code>input=${filename}</code>. If included, then the input parameters will be read from this filename. Otherwise, the parameters will be read from the executable arguments. The wrapper uses default values for parameters if none are provided. </p><div class="fragment"><div class="line">MAST::Examples::GetPotWrapper</div><div class="line">input(argc, argv, <span class="stringliteral">&quot;input&quot;</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">dim                 = 2,</div><div class="line">nx_divs             = 3,</div><div class="line">ny_divs             = 1,</div><div class="line">panel_bc_id         = 4,     <span class="comment">// this is the id of the boundary set for panel</span></div><div class="line">symmetry_bc_id      = 5,     <span class="comment">// this is the id of the boundary set for remaining region on the bottom</span></div><div class="line">n_modes             = input(<span class="stringliteral">&quot;n_modes&quot;</span>, <span class="stringliteral">&quot;number of structural modes to use for creation of reduced order flutter eigenproblem&quot;</span>, 8),</div><div class="line">n_divs_ff_to_panel  = input(<span class="stringliteral">&quot;n_divs_farfield_to_panel&quot;</span>, <span class="stringliteral">&quot;number of element divisions from far-field to panel&quot;</span>, 30),</div><div class="line">n_divs_panel        = input(<span class="stringliteral">&quot;n_divs_panel&quot;</span>, <span class="stringliteral">&quot;number of element divisions on panel&quot;</span>, 10),</div><div class="line">n_k_divs            = input(<span class="stringliteral">&quot;n_k_divs&quot;</span>, <span class="stringliteral">&quot;number of divisions between upper and lower reduced frequencies for search of flutter root&quot;</span>, 10),</div><div class="line">max_bisection_iters = input(<span class="stringliteral">&quot;flutter_max_bisection_it&quot;</span>, <span class="stringliteral">&quot;maximum number of bisection iterations to search flutter root after initial sweep of reduced frequencies&quot;</span>, 10);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">k_upper             = input(<span class="stringliteral">&quot;k_upper&quot;</span>, <span class="stringliteral">&quot;upper value of reduced frequency for flutter solver&quot;</span>, 0.75),</div><div class="line">k_lower             = input(<span class="stringliteral">&quot;k_lower&quot;</span>, <span class="stringliteral">&quot;lower value of reduced frequency for flutter solver&quot;</span>, 0.00),</div><div class="line">tol                 = input(  <span class="stringliteral">&quot;g_tol&quot;</span>, <span class="stringliteral">&quot;tolerace for convergence of damping of flutter root&quot;</span>, 1e-4),</div><div class="line">length              = input(<span class="stringliteral">&quot;panel_l&quot;</span>,                                     <span class="stringliteral">&quot;length of panel&quot;</span>,  0.3),</div><div class="line">ff_to_panel_l       = input(<span class="stringliteral">&quot;farfield_to_l_ratio&quot;</span>, <span class="stringliteral">&quot;Ratio of distance of farfield boundary to panel length&quot;</span>,  5.0),</div><div class="line">ff_to_panel_e_size  = input(<span class="stringliteral">&quot;farfield_to_panel_elem_size_ratio&quot;</span>, <span class="stringliteral">&quot;Ratio of element size at far-field to element size at panel&quot;</span>,  20.0);</div></div><!-- fragment --><h1><a class="anchor" id="fluid_init"></a>
Initialize Fluid Solver</h1>
<div class="fragment"><div class="line">std::string s;</div><div class="line">s                   = input(<span class="stringliteral">&quot;fe_order&quot;</span>, <span class="stringliteral">&quot;order of finite element shape basis functions&quot;</span>,     <span class="stringliteral">&quot;first&quot;</span>);</div><div class="line">libMesh::Order</div><div class="line">fe_order            = libMesh::Utility::string_to_enum&lt;libMesh::Order&gt;(s);</div><div class="line">s                   = input(<span class="stringliteral">&quot;fluid_elem_type&quot;</span>,  <span class="stringliteral">&quot;type of geometric element in the fluid mesh&quot;</span>,     <span class="stringliteral">&quot;quad4&quot;</span>);</div><div class="line">libMesh::ElemType</div><div class="line">elem_type           = libMesh::Utility::string_to_enum&lt;libMesh::ElemType&gt;(s);</div><div class="line">s                   = input(<span class="stringliteral">&quot;fe_family&quot;</span>,      <span class="stringliteral">&quot;family of finite element shape functions&quot;</span>, <span class="stringliteral">&quot;lagrange&quot;</span>);</div><div class="line">libMesh::FEFamily</div><div class="line">fe_family           = libMesh::Utility::string_to_enum&lt;libMesh::FEFamily&gt;(s);</div></div><!-- fragment --><p> setting up fluid mesh </p><div class="fragment"><div class="line">std::vector&lt;Real&gt;</div><div class="line">x_div_loc           = {-length*ff_to_panel_l, 0., length, length*(1.+ff_to_panel_l)},</div><div class="line">x_relative_dx       = {ff_to_panel_e_size, 1., 1., ff_to_panel_e_size},</div><div class="line">y_div_loc           = {0., length*ff_to_panel_l},</div><div class="line">y_relative_dx       = {1., ff_to_panel_e_size};</div><div class="line"></div><div class="line">std::vector&lt;unsigned int&gt;</div><div class="line">x_divs              = {n_divs_ff_to_panel, n_divs_panel, n_divs_ff_to_panel},</div><div class="line">y_divs              = {n_divs_ff_to_panel};</div><div class="line"></div><div class="line">MAST::MeshInitializer::CoordinateDivisions</div><div class="line">x_coord_divs,</div><div class="line">y_coord_divs;</div><div class="line"></div><div class="line">x_coord_divs.init(nx_divs, x_div_loc, x_relative_dx, x_divs);</div><div class="line">y_coord_divs.init(ny_divs, y_div_loc, y_relative_dx, y_divs);</div><div class="line"></div><div class="line">std::vector&lt;MAST::MeshInitializer::CoordinateDivisions*&gt;</div><div class="line">divs = {&amp;x_coord_divs, &amp;y_coord_divs};</div></div><!-- fragment --><p> initialize the fluid mesh </p><div class="fragment"><div class="line">libMesh::ParallelMesh</div><div class="line">fluid_mesh(init.comm());</div></div><!-- fragment --><p> initialize the mesh </p><div class="fragment"><div class="line">MAST::PanelMesh2D().init(0.,               <span class="comment">// t/c</span></div><div class="line">                         <span class="keyword">false</span>,            <span class="comment">// if cos bump</span></div><div class="line">                         0,                <span class="comment">// n max bumps</span></div><div class="line">                         divs,</div><div class="line">                         fluid_mesh,</div><div class="line">                         elem_type);</div></div><!-- fragment --><p> initialize equation system </p><div class="fragment"><div class="line">libMesh::EquationSystems</div><div class="line">fluid_eq_sys(fluid_mesh);</div></div><!-- fragment --><p> add the system to be used for fluid analysis </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html">MAST::NonlinearSystem</a></div><div class="line">&amp;fluid_sys = fluid_eq_sys.add_system&lt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html">MAST::NonlinearSystem</a>&gt;(<span class="stringliteral">&quot;fluid&quot;</span>);</div></div><!-- fragment --><p> fluid properties, boundary conditions </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_conservative_fluid_discipline.html">MAST::ConservativeFluidDiscipline</a></div><div class="line">fluid_discipline(fluid_eq_sys);</div></div><!-- fragment --><p> variables </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_conservative_fluid_system_initialization.html">MAST::ConservativeFluidSystemInitialization</a></div><div class="line">fluid_sys_init(fluid_sys,</div><div class="line">               fluid_sys.name(),</div><div class="line">               libMesh::FEType(fe_order, fe_family), dim);</div></div><!-- fragment --><p> keep fluid boundary on all partitions </p><div class="fragment"><div class="line">MAST::AugmentGhostElementSendListObj augment_send_list_obj(fluid_sys);</div><div class="line">fluid_sys.get_dof_map().attach_extra_send_list_object(augment_send_list_obj);</div><div class="line"></div><div class="line">fluid_eq_sys.init();</div></div><!-- fragment --><p> print the information </p><div class="fragment"><div class="line">fluid_mesh.print_info();</div><div class="line">fluid_eq_sys.print_info();</div></div><!-- fragment --><p> create the boundary conditions for slip-wall and far-field </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a></div><div class="line">far_field(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a972c0a76e95febf5fa4062c14e894eed">MAST::FAR_FIELD</a>),</div><div class="line">symm_wall(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a2e0e3d4e05bf3d344d4ca55f6ae1070a">MAST::SYMMETRY_WALL</a>),</div><div class="line">slip_wall(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a446acb4f34e709dc5f00a484427bc0a1">MAST::SLIP_WALL</a>);</div></div><!-- fragment --><p> tell the physics about boundary conditions </p><div class="fragment"><div class="line">fluid_discipline.add_side_load(   panel_bc_id, slip_wall);</div><div class="line">fluid_discipline.add_side_load(symmetry_bc_id, symm_wall);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=1; i&lt;=3; i++)</div><div class="line">    fluid_discipline.add_side_load(i, far_field);</div></div><!-- fragment --><p> set fluid properties </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_flight_condition.html">MAST::FlightCondition</a> flight_cond;</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a4f176e2d606ac85dcd7c72279ff3968a">flow_unit_vector</a> &lt;&lt; 1, 0, 0;</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a7f4c19492fc7dfe06c31544988880823">ref_chord</a>        = length;</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ac6c069ed04c2eb39a08c128fdbda03ee">mach</a>             = input(<span class="stringliteral">&quot;fluid_mach&quot;</span>, <span class="stringliteral">&quot;fluid Mach number&quot;</span>,                           0.5);</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a92b01d0be8918227a715c96de3ebf3a3">cp</a>  = input(<span class="stringliteral">&quot;fluid_cp&quot;</span>,   <span class="stringliteral">&quot;fluid specific heat at constant pressure&quot;</span>,  1003.);</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a0447c63ba1e7d31a6fa4b8ad6fed9c6b">cv</a>  = input(<span class="stringliteral">&quot;fluid_cv&quot;</span>,   <span class="stringliteral">&quot;fluid specific heat at constant volume&quot;</span>,     716.);</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#afa0d31c3e80e53912988ffaa34048d2b">T</a>   = input(<span class="stringliteral">&quot;fluid_T&quot;</span>,    <span class="stringliteral">&quot;fluid absolute temperature&quot;</span>,                 300.);</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ac689842845c17faac68825f77a14087b">rho</a> = input(<span class="stringliteral">&quot;fluid_rho&quot;</span>,  <span class="stringliteral">&quot;fluid density&quot;</span>,                              1.35);</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ad3162d50c07ce8f9eba961d09164a93d">init</a>();</div></div><!-- fragment --><p> tell the discipline about the fluid values </p><div class="fragment"><div class="line">fluid_discipline.set_flight_condition(flight_cond);</div></div><!-- fragment --><p> define parameters </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_parameter.html">MAST::Parameter</a></div><div class="line">omega    (   <span class="stringliteral">&quot;omega&quot;</span>, 0.),</div><div class="line">velocity (<span class="stringliteral">&quot;velocity&quot;</span>, flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a34d5b74a2c8bbeee63b9d5fa00b67a78">velocity_magnitude</a>()),</div><div class="line">b_ref    (   <span class="stringliteral">&quot;b_ref&quot;</span>, length);</div></div><!-- fragment --><p> now define the constant field functions based on this </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_constant_field_function.html">MAST::ConstantFieldFunction</a></div><div class="line">omega_f    (   <span class="stringliteral">&quot;omega&quot;</span>, omega),</div><div class="line">velocity_f (<span class="stringliteral">&quot;velocity&quot;</span>, velocity),</div><div class="line">b_ref_f    (   <span class="stringliteral">&quot;b_ref&quot;</span>, b_ref);</div></div><!-- fragment --><p> TODO: replace with interpolation </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_pressure_function.html">MAST::PressureFunction</a></div><div class="line">pressure_function(fluid_sys_init, flight_cond);</div><div class="line">pressure_function.set_calculate_cp(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_frequency_domain_pressure_function.html">MAST::FrequencyDomainPressureFunction</a></div><div class="line">freq_domain_pressure_function(fluid_sys_init, flight_cond);</div><div class="line">freq_domain_pressure_function.set_calculate_cp(<span class="keyword">true</span>);</div></div><!-- fragment --><h1><a class="anchor" id="structural_init"></a>
Initialize Structural Solver</h1>
<div class="fragment"><div class="line">x_div_loc = {0.0, length};</div><div class="line">x_relative_dx = {1., 1.};</div><div class="line">x_divs = {n_divs_panel};</div><div class="line"></div><div class="line">MAST::MeshInitializer::CoordinateDivisions</div><div class="line">x_coord_divs_struct;</div><div class="line">x_coord_divs_struct.init(1, x_div_loc, x_relative_dx, x_divs);</div><div class="line"></div><div class="line">divs = {&amp;x_coord_divs_struct};</div></div><!-- fragment --><p> create the mesh </p><div class="fragment"><div class="line">libMesh::SerialMesh structural_mesh(init.comm());</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (elem_type == libMesh::QUAD4)</div><div class="line">    MAST::MeshInitializer().init(divs, structural_mesh, libMesh::EDGE2);</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (elem_type == libMesh::QUAD8 || elem_type == libMesh::QUAD9)</div><div class="line">    MAST::MeshInitializer().init(divs, structural_mesh, libMesh::EDGE3);</div></div><!-- fragment --><p> create the equation system </p><div class="fragment"><div class="line">libMesh::EquationSystems structural_eq_sys(structural_mesh);</div></div><!-- fragment --><p> create the libmesh system </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html">MAST::NonlinearSystem</a></div><div class="line">&amp;structural_sys = structural_eq_sys.add_system&lt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html">MAST::NonlinearSystem</a>&gt;(<span class="stringliteral">&quot;structural&quot;</span>);</div><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a081daabdb69d1a500c926762fb1c6038">set_eigenproblem_type</a>(libMesh::GHEP);</div></div><!-- fragment --><p> initialize the system to the right set of variables </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html">MAST::PhysicsDisciplineBase</a></div><div class="line">structural_discipline(structural_eq_sys);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_structural_system_initialization.html">MAST::StructuralSystemInitialization</a></div><div class="line">structural_sys_init(structural_sys,</div><div class="line">                    structural_sys.name(),</div><div class="line">                    libMesh::FEType(fe_order, fe_family));</div></div><!-- fragment --><p> create and add the boundary condition and loads </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a></div><div class="line">dirichlet_left,</div><div class="line">dirichlet_right;</div><div class="line">std::vector&lt;unsigned int&gt; constrained_vars = {0, 1, 2, 3}; <span class="comment">// u, v, w, tx</span></div><div class="line">dirichlet_left.<a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html#a7fe64cf8537780d8b6c89294e3dc3cde">init</a> (0, constrained_vars);</div><div class="line">dirichlet_right.<a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html#a7fe64cf8537780d8b6c89294e3dc3cde">init</a>(1, constrained_vars);</div><div class="line"></div><div class="line">structural_discipline.add_dirichlet_bc(0, dirichlet_left);</div><div class="line">structural_discipline.add_dirichlet_bc(1, dirichlet_right);</div><div class="line">structural_discipline.init_system_dirichlet_bc(structural_sys);</div><div class="line"></div><div class="line">MAST::ConstrainBeamDofs constraint_beam_dofs(structural_sys);</div><div class="line">structural_sys.attach_constraint_object(constraint_beam_dofs);</div></div><!-- fragment --><p> initialize the equation system </p><div class="fragment"><div class="line">structural_eq_sys.init();</div></div><!-- fragment --><p> print information </p><div class="fragment"><div class="line">structural_mesh.print_info();</div><div class="line">structural_eq_sys.print_info();</div></div><!-- fragment --><p> TODO: replace this functionality in conservative_fluid_element </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_complex_mesh_field_function.html">MAST::ComplexMeshFieldFunction</a></div><div class="line">displ(structural_sys_init, <span class="stringliteral">&quot;frequency_domain_displacement&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_complex_normal_rotation_mesh_function.html">MAST::ComplexNormalRotationMeshFunction</a></div><div class="line">normal_rot(<span class="stringliteral">&quot;frequency_domain_normal_rotation&quot;</span>, displ);</div><div class="line"></div><div class="line">slip_wall.add(displ);</div><div class="line">slip_wall.add(normal_rot);</div></div><!-- fragment --><p> set up structural eigenvalue problem </p><div class="fragment"><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a033caf367f2948d3f44e0d7e3ad1387e">eigen_solver</a>-&gt;set_position_of_spectrum(libMesh::LARGEST_MAGNITUDE);</div><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#af33c95057746da93d4a5f65ffe02ec0f">set_exchange_A_and_B</a>(<span class="keyword">true</span>);</div><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a875e777d4051530ad52bc505d1fe9112">set_n_requested_eigenvalues</a>(n_modes);</div></div><!-- fragment --><p> create the property functions and add them to the material property card </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_parameter.html">MAST::Parameter</a></div><div class="line">thy        (<span class="stringliteral">&quot;thy&quot;</span>, input(<span class="stringliteral">&quot;str_thickness&quot;</span>,  <span class="stringliteral">&quot;thickness of beam&quot;</span>,            0.0015)),</div><div class="line">thz        (<span class="stringliteral">&quot;thz&quot;</span>, 1.00),</div><div class="line">rho        (<span class="stringliteral">&quot;rho&quot;</span>, input(<span class="stringliteral">&quot;str_rho&quot;</span>,  <span class="stringliteral">&quot;structural material density&quot;</span>,         2.7e3)),</div><div class="line">E          (<span class="stringliteral">&quot;E&quot;</span>,   input(<span class="stringliteral">&quot;str_E&quot;</span>,    <span class="stringliteral">&quot;structural material Young&#39;s modulus&quot;</span>, 72.e9)),</div><div class="line">nu         (<span class="stringliteral">&quot;nu&quot;</span>,  input(<span class="stringliteral">&quot;str_nu&quot;</span>,   <span class="stringliteral">&quot;structural material Poisson&#39;s ratio&quot;</span>,  0.33)),</div><div class="line">kappa      (<span class="stringliteral">&quot;kappa&quot;</span>, 5./6.),</div><div class="line">zero       (<span class="stringliteral">&quot;zero&quot;</span>, 0.);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_constant_field_function.html">MAST::ConstantFieldFunction</a></div><div class="line">thy_f      (<span class="stringliteral">&quot;hy&quot;</span>, thy),</div><div class="line">thz_f      (<span class="stringliteral">&quot;hz&quot;</span>, thz),</div><div class="line">rho_f      (<span class="stringliteral">&quot;rho&quot;</span>, rho),</div><div class="line">E_f        (<span class="stringliteral">&quot;E&quot;</span>, E),</div><div class="line">nu_f       (<span class="stringliteral">&quot;nu&quot;</span>, nu),</div><div class="line">kappa_f    (<span class="stringliteral">&quot;kappa&quot;</span>, kappa),</div><div class="line">hyoff_f    (<span class="stringliteral">&quot;hy_off&quot;</span>, zero),</div><div class="line">hzoff_f    (<span class="stringliteral">&quot;hz_off&quot;</span>, zero);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_isotropic_material_property_card.html">MAST::IsotropicMaterialPropertyCard</a></div><div class="line">m_card;</div><div class="line">m_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(rho_f);</div><div class="line">m_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(E_f);</div><div class="line">m_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(nu_f);</div><div class="line">m_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(kappa_f);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_solid1_d_section_element_property_card.html">MAST::Solid1DSectionElementPropertyCard</a></div><div class="line">p_card;</div><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_element_property_card1_d.html#a354aeacd93d0ae69023f2f1e38494f8e">set_bending_model</a>(<a class="code" href="namespace_m_a_s_t.html#a94a01c803186334c9074965d417ba049ade1587d930f3eb8af7ce43b7be2058b5">MAST::TIMOSHENKO</a>);</div></div><!-- fragment --><p> tell the card about the orientation </p><div class="fragment"><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_element_property_card1_d.html#a82f8c6cee367fbe4d3e4796d4d78ac72">y_vector</a>()    = RealVectorX::Zero(3);</div><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_element_property_card1_d.html#a82f8c6cee367fbe4d3e4796d4d78ac72">y_vector</a>()(1) = 1.;</div></div><!-- fragment --><p> add the section properties to the card </p><div class="fragment"><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(thy_f);</div><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(thz_f);</div><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(hyoff_f);</div><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_function_set_base.html#a1c62b64f2321709d3f238290040275db">add</a>(hzoff_f);</div></div><!-- fragment --><p> tell the section property about the material property </p><div class="fragment"><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_solid1_d_section_element_property_card.html#a0c7b6391adfbf8add847d6654302ed73">set_material</a>(m_card);</div><div class="line"></div><div class="line">p_card.<a class="code" href="class_m_a_s_t_1_1_solid1_d_section_element_property_card.html#af178105164672584bc316823ebf2e4e0">init</a>();</div><div class="line"></div><div class="line">structural_discipline.set_property_for_subdomain(0, p_card);</div></div><!-- fragment --><p> pressure boundary condition for the beam </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a> pressure(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14aa4f09fd4e780fcff93f4362894b8b4c8">MAST::SURFACE_PRESSURE</a>);</div><div class="line">pressure.add(pressure_function);</div><div class="line">pressure.add(freq_domain_pressure_function);</div><div class="line">structural_discipline.add_volume_load(0, pressure);</div></div><!-- fragment --><h1><a class="anchor" id="flutter_init"></a>
Initialize Flutter Solver</h1>
<div class="fragment"></div><!-- fragment --><p> initialize the frequency function </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_frequency_function.html">MAST::FrequencyFunction</a></div><div class="line">freq_function(<span class="stringliteral">&quot;freq&quot;</span>, omega_f, velocity_f, b_ref_f);</div><div class="line">freq_function.if_nondimensional(<span class="keyword">true</span>);</div></div><!-- fragment --><p>INITIALIZE FLUID SOLUTION</p>
<p>the modal and flutter problems are solved on rank 0, while the fluid solution is setup on the global communicator </p><div class="fragment"></div><!-- fragment --><p> initialize the solution </p><div class="fragment"><div class="line"><a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a> fluid_ff_vars(4);</div><div class="line">fluid_ff_vars &lt;&lt; flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#adacb8be0492216b2d1221f068b40a635">rho</a>(),</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a9f48602f9d934d032aed6055c9d0bf4b">rho_u1</a>(),</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a48f8845eb1157c63bbae15ee35462bbc">rho_u2</a>(),</div><div class="line">flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a704c03b0b71a5ab3c1ac383d1b62b2f2">rho_e</a>();</div></div><!-- fragment --><p> create the vector for storing the base solution. we will swap this out with the system solution, initialize and then swap it back. </p><div class="fragment"><div class="line">libMesh::NumericVector&lt;Real&gt;&amp; base_sol =</div><div class="line">fluid_sys.add_vector(<span class="stringliteral">&quot;fluid_base_solution&quot;</span>);</div><div class="line">fluid_sys.solution-&gt;swap(base_sol);</div><div class="line">fluid_sys_init.initialize_solution(fluid_ff_vars);</div><div class="line">fluid_sys.solution-&gt;swap(base_sol);</div></div><!-- fragment --><p> create the nonlinear assembly object </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_frequency_domain_linearized_complex_assembly_elem_operations.html">MAST::FrequencyDomainLinearizedComplexAssemblyElemOperations</a> fluid_elem_ops;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_complex_assembly_base.html">MAST::ComplexAssemblyBase</a>                                    complex_assembly;</div></div><!-- fragment --><p> now set up the assembly objects </p><div class="fragment"><div class="line">fluid_elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(fluid_discipline, fluid_sys_init);</div><div class="line">complex_assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0644e12cd53adc64d9b7e027becc08b5">set_discipline_and_system</a>(fluid_discipline, fluid_sys_init);</div><div class="line">complex_assembly.<a class="code" href="class_m_a_s_t_1_1_complex_assembly_base.html#ae5018147a4989e3023679dd3819b71bd">set_base_solution</a>(base_sol);</div><div class="line">fluid_elem_ops.<a class="code" href="class_m_a_s_t_1_1_frequency_domain_linearized_complex_assembly_elem_operations.html#a4290d7bec8e640e53530a7839062461d">set_frequency_function</a>(freq_function);</div><div class="line"></div><div class="line">pressure_function.init(base_sol);</div></div><!-- fragment --><h1><a class="anchor" id="solution"></a>
Solution</h1>
<h2><a class="anchor" id="modal_sol"></a>
Structural Modal Solution</h2>
<div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_eigenproblem_assembly.html">MAST::EigenproblemAssembly</a> modal_assembly;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_structural_modal_eigenproblem_assembly_elem_operations.html">MAST::StructuralModalEigenproblemAssemblyElemOperations</a> modal_elem_ops;</div><div class="line"></div><div class="line">modal_assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0644e12cd53adc64d9b7e027becc08b5">set_discipline_and_system</a>(structural_discipline, structural_sys_init);</div><div class="line">modal_elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(structural_discipline, structural_sys_init);</div><div class="line"></div><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#aef44ff5f73171cec65d522b4e75a2797">initialize_condensed_dofs</a>(structural_discipline);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_structural_near_null_vector_space.html">MAST::StructuralNearNullVectorSpace</a> nsp;</div><div class="line">structural_sys.nonlinear_solver-&gt;nearnullspace_object = &amp;nsp;</div><div class="line"></div><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a2986ba3e2b32c728c79c278204f2e468">eigenproblem_solve</a>(modal_elem_ops, modal_assembly);</div><div class="line">modal_assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a9f7f65a2be3dc8f6edb9000020aa8ccf">clear_discipline_and_system</a>();</div><div class="line">modal_elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#ab795ab85f3e09c191d8876f1c6ed2847">clear_discipline_and_system</a>();</div></div><!-- fragment --><p> Get the number of converged eigen pairs. </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">nconv = std::min(structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#ab7060976615d42252dd36557967d98fa">get_n_converged_eigenvalues</a>(),</div><div class="line">                 structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a7d8ad289f9a9428b58c62b5c671c7e0e">get_n_requested_eigenvalues</a>());</div><div class="line"></div><div class="line">std::vector&lt;libMesh::NumericVector&lt;Real&gt;*&gt; basis(nconv, <span class="keyword">nullptr</span>);</div><div class="line"></div><div class="line">libMesh::ExodusII_IO writer(structural_mesh);</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nconv; i++) {</div></div><!-- fragment --><p> create a vector to store the basis </p><div class="fragment"><div class="line">basis[i] = structural_sys.solution-&gt;zero_clone().release();</div></div><!-- fragment --><p> now write the eigenvalue </p><div class="fragment"><div class="line"><a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">re = 0.,</div><div class="line">im = 0.;</div><div class="line">structural_sys.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#aa67d9d7b6f199f73341296cebbfcfcd2">get_eigenpair</a>(i, re, im, *basis[i]);</div><div class="line"></div><div class="line">libMesh::out</div><div class="line">&lt;&lt; std::setw(35) &lt;&lt; std::fixed &lt;&lt; std::setprecision(15)</div><div class="line">&lt;&lt; re &lt;&lt; std::endl;</div></div><!-- fragment --><p> We write the file in the ExodusII format. copy the solution for output </p><div class="fragment"><div class="line">    structural_sys.solution-&gt;swap(*basis[i]);</div><div class="line">    writer.write_timestep(<span class="stringliteral">&quot;modes.exo&quot;</span>,</div><div class="line">                          structural_eq_sys,</div><div class="line">                          i+1, i);</div><div class="line">    structural_sys.solution-&gt;swap(*basis[i]);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="flutter_sol"></a>
Flutter Solution</h2>
<div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_u_g_flutter_solver.html">MAST::UGFlutterSolver</a> flutter_solver;</div></div><!-- fragment --><p> solver for complex solution </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_complex_solver_base.html">MAST::ComplexSolverBase</a> solver;</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_f_s_i_generalized_aero_force_assembly.html">MAST::FSIGeneralizedAeroForceAssembly</a>      fsi_assembly;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_fluid_structure_assembly_elem_operations.html">MAST::FluidStructureAssemblyElemOperations</a> fsi_elem_ops;</div><div class="line">fsi_assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0644e12cd53adc64d9b7e027becc08b5">set_discipline_and_system</a>(structural_discipline, structural_sys_init);</div><div class="line">fsi_elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(structural_discipline, structural_sys_init);</div><div class="line"></div><div class="line">fsi_assembly.<a class="code" href="class_m_a_s_t_1_1_f_s_i_generalized_aero_force_assembly.html#ab0206e28a8de44cf117ffc56fbab5262">init</a>(fsi_elem_ops,</div><div class="line">                  solver,                       <span class="comment">// fluid complex solver</span></div><div class="line">                  complex_assembly,</div><div class="line">                  fluid_elem_ops,</div><div class="line">                  pressure_function,</div><div class="line">                  freq_domain_pressure_function,</div><div class="line">                  displ);</div><div class="line"></div><div class="line">flutter_solver.<a class="code" href="class_m_a_s_t_1_1_flutter_solver_base.html#a6ebffe4c7aa28c287deff6bb504d753b">attach_assembly</a>(fsi_assembly);</div><div class="line">flutter_solver.<a class="code" href="class_m_a_s_t_1_1_u_g_flutter_solver.html#a3dcb20ad4e686ce2cc9659dad5effca4">initialize</a>(omega,</div><div class="line">                          b_ref,</div><div class="line">                          flight_cond.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#adacb8be0492216b2d1221f068b40a635">rho</a>(),</div><div class="line">                          k_lower,            <span class="comment">// lower kr</span></div><div class="line">                          k_upper,            <span class="comment">// upper kr</span></div><div class="line">                          n_k_divs,           <span class="comment">// number of divisions</span></div><div class="line">                          basis);             <span class="comment">// basis vectors</span></div><div class="line"></div><div class="line">std::ostringstream oss;</div><div class="line">oss &lt;&lt; <span class="stringliteral">&quot;flutter_output_&quot;</span> &lt;&lt; init.comm().rank() &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><span class="keywordflow">if</span> (init.comm().rank() == 0)</div><div class="line">    flutter_solver.<a class="code" href="class_m_a_s_t_1_1_flutter_solver_base.html#a855b8458a7a451b42da701bdac8ec425">set_output_file</a>(oss.str());</div></div><!-- fragment --><p> find the roots for the specified divisions </p><div class="fragment"><div class="line">flutter_solver.<a class="code" href="class_m_a_s_t_1_1_u_g_flutter_solver.html#ac9a3d02c50d12262acb7f5553dea6532">scan_for_roots</a>();</div><div class="line">flutter_solver.<a class="code" href="class_m_a_s_t_1_1_u_g_flutter_solver.html#a894cd84e5d2da97c14e0c21413bcedf9">print_crossover_points</a>();</div></div><!-- fragment --><p> now ask the flutter solver to return the critical flutter root, which is the flutter cross-over point at the lowest velocity </p><div class="fragment"><div class="line">std::pair&lt;bool, MAST::FlutterRootBase*&gt;</div><div class="line">sol = flutter_solver.<a class="code" href="class_m_a_s_t_1_1_u_g_flutter_solver.html#a89e0fe072c3d810753925f0cd0674028">find_critical_root</a>(tol, max_bisection_iters);</div><div class="line"></div><div class="line">flutter_solver.<a class="code" href="class_m_a_s_t_1_1_u_g_flutter_solver.html#a04783bcd0dfc1af3e8203335d4af9677">print_sorted_roots</a>();</div></div><!-- fragment --><p> make sure solution was found </p><div class="fragment"><div class="line">libmesh_assert(sol.first);</div></div><!-- fragment --> <h2><a class="anchor" id="plot_flutter"></a>
Plot Flutter Solution</h2>
<div class="fragment"><div class="line">MAST::plot_structural_flutter_solution(<span class="stringliteral">&quot;structural_flutter_mode.exo&quot;</span>,</div><div class="line">                                       structural_sys,</div><div class="line">                                       sol.second-&gt;eig_vec_right,</div><div class="line">                                       basis);</div><div class="line"></div><div class="line">MAST::plot_fluid_flutter_solution(<span class="stringliteral">&quot;fluid_flutter_mode.exo&quot;</span>,</div><div class="line">                                  structural_sys,</div><div class="line">                                  fluid_sys,</div><div class="line">                                  displ,</div><div class="line">                                  solver,</div><div class="line">                                  sol.second-&gt;eig_vec_right,</div><div class="line">                                  basis);</div></div><!-- fragment --><p> cleanup the data structures </p><div class="fragment"><div class="line">fsi_assembly.<a class="code" href="class_m_a_s_t_1_1_f_s_i_generalized_aero_force_assembly.html#a21aaac22c99ca7dc2e5d86f14143aa1e">clear_discipline_and_system</a>();</div><div class="line">fsi_elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#ab795ab85f3e09c191d8876f1c6ed2847">clear_discipline_and_system</a>();</div><div class="line">flutter_solver.<a class="code" href="class_m_a_s_t_1_1_flutter_solver_base.html#ab11b397337eefd944864993b156c8be3">clear_assembly_object</a>();</div><div class="line">complex_assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a9f7f65a2be3dc8f6edb9000020aa8ccf">clear_discipline_and_system</a>();</div></div><!-- fragment --><p> delete the basis vectors </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;basis.size(); i++)</div><div class="line">    <span class="keywordflow">if</span> (basis[i]) <span class="keyword">delete</span> basis[i];</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="TutorialsPage.html">Tutorials for MAST</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
