<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>MAST: Flow analysis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MAST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fluid_example_1.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Flow analysis </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#mesh">Mesh generation</a><ul><li class="level2"><a href="#naca0012_mesh">NACA0012</a></li>
<li class="level2"><a href="#cylinder_mesh">Cylinder</a></li>
<li class="level2"><a href="#naca0012_wing_mesh">NACA0012 Wing</a></li>
<li class="level2"><a href="#mfu_mesh">Minimal Flow Unit</a></li>
<li class="level2"><a href="#panel_2d_mesh">Two-dimensional Panel Flow</a></li>
</ul>
</li>
<li class="level1"><a href="#fluid_sol_init">Initialization of solution</a><ul><li class="level2"><a href="#initial_sol">Initial solution</a></li>
<li class="level2"><a href="#initial_sens_sol">Initial sensitivity solution</a></li>
</ul>
</li>
<li class="level1"><a href="#flow_analysis_class">Example class</a><ul><li class="level2"><a href="#flow_analysis_class_constructor">Constructor</a></li>
<li class="level2"><a href="#flow_analysis_class_destructor">Destructor</a></li>
</ul>
</li>
<li class="level1"><a href="#flow_computation">Computation</a><ul><li class="level2"><a href="#flow_transient_analysis">Transient analysis</a></li>
<li class="level2"><a href="#flow_transient_sensitivity_analysis">Transient sensitivity analysis</a></li>
<li class="level2"><a href="#flow_transient_stabilized_sensitivity_analysis">Transient stabilized sensitivity analysis</a></li>
</ul>
</li>
<li class="level1"><a href="#flow_driver">Main function</a></li>
</ul>
</div>
<div class="textblock"><p>This example computes the steady-state flow about rigid shapes.</p>
<p>A Newmark time integration is used for time-stepping. Since a time-accurate flow solution is not sought the Newton-Raphson scheme at each time-step is only partially converged. The following options can be used to tune the SNES solver in PETSc to accomplish this: ``` -snes_linesearch_type basic -snes_linesearch_damping 1.0 -snes_linesearch_max_it 1 -snes_max_it 2 ```</p>
<p>This class stores all the data structures necessary to setup a flow analysis </p><div class="fragment"><div class="line"><span class="keyword">class </span>FlowAnalysis {</div><div class="line">    </div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    </div><div class="line">    libMesh::LibMeshInit&amp;                          _init;</div><div class="line">    MAST::Examples::GetPotWrapper&amp;                 _input;</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                   _dim;</div><div class="line">    libMesh::UnstructuredMesh*                     _mesh;</div><div class="line">    libMesh::EquationSystems*                      _eq_sys;</div><div class="line">    <a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html">MAST::NonlinearSystem</a>*                         _sys;</div><div class="line">    <a class="code" href="class_m_a_s_t_1_1_conservative_fluid_system_initialization.html">MAST::ConservativeFluidSystemInitialization</a>*   _sys_init;</div><div class="line">    <a class="code" href="class_m_a_s_t_1_1_conservative_fluid_discipline.html">MAST::ConservativeFluidDiscipline</a>*             _discipline;</div><div class="line">    <a class="code" href="class_m_a_s_t_1_1_flight_condition.html">MAST::FlightCondition</a>*                         _flight_cond;</div><div class="line">    </div><div class="line">    libMesh::ExodusII_IO*                          _output;</div><div class="line">    </div><div class="line">    libMesh::FEType                                _fetype;</div><div class="line"></div><div class="line">    std::set&lt;MAST::BoundaryConditionBase*&gt;         _boundary_conditions;</div><div class="line">    std::set&lt;libMesh::PeriodicBoundary*&gt;           _periodic_boundaries;</div></div><!-- fragment --><h1><a class="anchor" id="mesh"></a>
Mesh generation</h1>
<p>This will initialize the mesh </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_mesh(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div></div><!-- fragment --><p> The mesh is created using classes written in <a class="el" href="namespace_m_a_s_t.html">MAST</a>. The particular mesh to be used can be selected using the input parameter <code>mesh=val</code>, where <code>val</code> can be one of the following:</p><ul>
<li><code>naca0012</code> for flow over a NACA 0012 airfoil</li>
<li><code>cylinder</code> for flow over a cylinder</li>
<li><code>naca0012_wing</code> for flow over swept wing with NACA0012 section</li>
<li><code>panel_2D</code> for 2D flow analysis over a panel</li>
<li><code>panel_3D</code> for 3D flow analysis over a panel</li>
<li><code>mfu</code> for 3D flow analysis over a minimal flow unit</li>
</ul>
<p>The meshing and boundary conditions for each flow analysis case can be modified using suitable parameters, which are described in this example. </p><div class="fragment"><div class="line">    std::string</div><div class="line">    s  = _input(<span class="stringliteral">&quot;mesh&quot;</span>,</div><div class="line">                <span class="stringliteral">&quot;type of mesh to be analyzed {naca0012, cylinder, naca0012_wing, panel_2D, panel_3D, mfu}&quot;</span>,</div><div class="line">                <span class="stringliteral">&quot;naca0012&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;naca0012&quot;</span>)</div><div class="line">        _init_naca0012(mesh, bc);</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;cylinder&quot;</span>)</div><div class="line">        _init_cylinder(mesh, bc);</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;naca0012_wing&quot;</span>)</div><div class="line">        _init_naca0012_wing(mesh, bc);</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;panel_2d&quot;</span>)</div><div class="line">        _init_panel_2D(mesh, bc);</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;panel_3d&quot;</span>)</div><div class="line">        _init_panel_3D(mesh, bc);</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">&quot;mfu&quot;</span>)</div><div class="line">        _init_minimal_flow_unit(mesh, bc);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        libmesh_error_msg(<span class="stringliteral">&quot;unknown mesh type&quot;</span>);</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="naca0012_mesh"></a>
NACA0012</h2>
<p>If <code>mesh</code> is <code>true</code> then the mesh will be initialized. If <code>bc</code> is true then the boundary conditions will be initialized </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_naca0012(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (mesh) {</div><div class="line">        </div><div class="line">        _dim                 = 2;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">        radial_divs         = _input(<span class="stringliteral">&quot;n_radial_elems&quot;</span>, <span class="stringliteral">&quot;number of elements in the radial direction from airfoil to far-field&quot;</span>, 20),</div><div class="line">        quarter_divs        = _input(<span class="stringliteral">&quot;n_quarter_elems&quot;</span>, <span class="stringliteral">&quot;number of elements in the quarter arc along the circumferencial direction&quot;</span>, 20);</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">        r                   = _input(<span class="stringliteral">&quot;chord&quot;</span>, <span class="stringliteral">&quot;chord of the airfoil&quot;</span>, 0.1),</div><div class="line">        l_by_r              = _input(<span class="stringliteral">&quot;l_by_r&quot;</span>, <span class="stringliteral">&quot;far-field distance to airfoil radius ratio&quot;</span>, 5.),</div><div class="line">        h_ff_by_h_r         = _input(<span class="stringliteral">&quot;h_far_field_by_h_r&quot;</span>, <span class="stringliteral">&quot;relative element size at far-field boundary to element size at airfoil&quot;</span>, 50.);</div><div class="line">        </div><div class="line">        std::string</div><div class="line">        t = _input(<span class="stringliteral">&quot;elem_type&quot;</span>, <span class="stringliteral">&quot;type of geometric element in the mesh&quot;</span>, <span class="stringliteral">&quot;quad4&quot;</span>);</div><div class="line">        </div><div class="line">        libMesh::ElemType</div><div class="line">        e_type = libMesh::Utility::string_to_enum&lt;libMesh::ElemType&gt;(t);</div></div><!-- fragment --><p> initialize the mesh </p><div class="fragment"><div class="line">    MAST::Examples::NACA0012Mesh2D().mesh(r,</div><div class="line">                                          r*l_by_r,</div><div class="line">                                          radial_divs,</div><div class="line">                                          quarter_divs,</div><div class="line">                                          h_ff_by_h_r,</div><div class="line">                                          *_mesh,</div><div class="line">                                          e_type);</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (bc) {</div><div class="line">    </div><div class="line">    libmesh_assert(_flight_cond);</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    if_viscous = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ae890062dad6033d1853ddd9673e6e764">if_viscous</a>;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (if_viscous) {</div><div class="line"></div><div class="line">        <a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a></div><div class="line">        *dirichlet = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a>;</div><div class="line"></div><div class="line">        std::vector&lt;unsigned int&gt; constrained_vars(2);</div><div class="line">        constrained_vars[0] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[1];</div><div class="line">        constrained_vars[1] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[2];</div><div class="line">        dirichlet-&gt;<a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html#a7fe64cf8537780d8b6c89294e3dc3cde">init</a> (3, constrained_vars);</div><div class="line">        _discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#af0b4df38f1d01ceb173ba58da2112ba0">add_dirichlet_bc</a>(3, *dirichlet);</div><div class="line">        _discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a3e36617407739da87126767cb4af09f9">init_system_dirichlet_bc</a>(*_sys);</div><div class="line"></div><div class="line">        _boundary_conditions.insert(dirichlet);</div><div class="line">    }</div></div><!-- fragment --><p> create the boundary conditions for slip-wall, symmetry and far-field </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a></div><div class="line">*far_field   = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a972c0a76e95febf5fa4062c14e894eed">MAST::FAR_FIELD</a>),</div></div><!-- fragment --><p> if a viscous analysis is requested then set the wall to be a no-slip wall. Otherwise, use a slip wall for inviscid analysis </p><div class="fragment"><div class="line">*wall        = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(if_viscous?</div><div class="line">                                               <a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a5955b770b5761404b3105f0158cd4d74">MAST::NO_SLIP_WALL</a>:</div><div class="line">                                               <a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a446acb4f34e709dc5f00a484427bc0a1">MAST::SLIP_WALL</a>);</div></div><!-- fragment --><p> airfoil surface is boundary id 3 ... </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   3, *wall);</div></div><!-- fragment --><p> boundary id 1 is far field </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   1, *far_field);</div></div><!-- fragment --><p> store the pointers for later deletion in the destructor </p><div class="fragment"><div class="line">        _boundary_conditions.insert(far_field);</div><div class="line">        _boundary_conditions.insert(wall);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="cylinder_mesh"></a>
Cylinder</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_cylinder(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (mesh) {</div><div class="line"></div><div class="line">        _dim                 = 2;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">        radial_divs         = _input(<span class="stringliteral">&quot;n_radial_elems&quot;</span>, <span class="stringliteral">&quot;number of elements in the radial direction from cylinder to far-field&quot;</span>, 20),</div><div class="line">        quarter_divs        = _input(<span class="stringliteral">&quot;n_quarter_elems&quot;</span>, <span class="stringliteral">&quot;number of elements in the quarter arc along the circumferencial direction&quot;</span>, 20);</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">        r                   = _input(<span class="stringliteral">&quot;radius&quot;</span>, <span class="stringliteral">&quot;radius of the cylinder&quot;</span>, 0.1),</div><div class="line">        l_by_r              = _input(<span class="stringliteral">&quot;l_by_r&quot;</span>, <span class="stringliteral">&quot;far-field distance to cylinder radius ratio&quot;</span>, 5.),</div><div class="line">        h_ff_by_h_r         = _input(<span class="stringliteral">&quot;h_far_field_by_h_r&quot;</span>, <span class="stringliteral">&quot;relative element size at far-field boundary to element size at cylinder&quot;</span>, 50.);</div><div class="line">        </div><div class="line">        std::string</div><div class="line">        t = _input(<span class="stringliteral">&quot;elem_type&quot;</span>, <span class="stringliteral">&quot;type of geometric element in the mesh&quot;</span>, <span class="stringliteral">&quot;quad4&quot;</span>);</div><div class="line">        </div><div class="line">        libMesh::ElemType</div><div class="line">        e_type = libMesh::Utility::string_to_enum&lt;libMesh::ElemType&gt;(t);</div></div><!-- fragment --><p> initialize the mesh </p><div class="fragment"><div class="line">    MAST::Examples::CylinderMesh2D().mesh(r,</div><div class="line">                                          r*l_by_r,</div><div class="line">                                          radial_divs,</div><div class="line">                                          quarter_divs,</div><div class="line">                                          h_ff_by_h_r,</div><div class="line">                                          *_mesh,</div><div class="line">                                          e_type,</div><div class="line">                                          <span class="keyword">false</span>, 0, 0);</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (bc) {</div><div class="line"></div><div class="line">    libmesh_assert(_flight_cond);</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    if_viscous = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ae890062dad6033d1853ddd9673e6e764">if_viscous</a>;</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (if_viscous) {</div><div class="line">        </div><div class="line">        <a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a></div><div class="line">        *dirichlet = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a>;</div><div class="line">        </div><div class="line">        std::vector&lt;unsigned int&gt; constrained_vars(2);</div><div class="line">        constrained_vars[0] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[1];</div><div class="line">        constrained_vars[1] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[2];</div><div class="line">        dirichlet-&gt;<a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html#a7fe64cf8537780d8b6c89294e3dc3cde">init</a> (3, constrained_vars);</div><div class="line">        _discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#af0b4df38f1d01ceb173ba58da2112ba0">add_dirichlet_bc</a>(3, *dirichlet);</div><div class="line">        _discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a3e36617407739da87126767cb4af09f9">init_system_dirichlet_bc</a>(*_sys);</div><div class="line">        </div><div class="line">        _boundary_conditions.insert(dirichlet);</div><div class="line">    }</div></div><!-- fragment --><p> create the boundary conditions for slip-wall, symmetry and far-field </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a></div><div class="line">*far_field   = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a972c0a76e95febf5fa4062c14e894eed">MAST::FAR_FIELD</a>),</div></div><!-- fragment --><p> if a viscous analysis is requested then set the wall to be a no-slip wall. Otherwise, use a slip wall for inviscid analysis </p><div class="fragment"><div class="line">*wall        = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(if_viscous?</div><div class="line">                                               <a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a5955b770b5761404b3105f0158cd4d74">MAST::NO_SLIP_WALL</a>:</div><div class="line">                                               <a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a446acb4f34e709dc5f00a484427bc0a1">MAST::SLIP_WALL</a>);</div></div><!-- fragment --><p> Cylinder surface is boundary id 3 ... </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   3, *wall);</div></div><!-- fragment --><p> boundary id 1 is far field </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   1, *far_field);</div></div><!-- fragment --><p> store the pointers for later deletion in the destructor </p><div class="fragment"><div class="line">        _boundary_conditions.insert(far_field);</div><div class="line">        _boundary_conditions.insert(wall);</div><div class="line"></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="naca0012_wing_mesh"></a>
NACA0012 Wing</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_naca0012_wing(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div><div class="line"> </div><div class="line">    <span class="keywordflow">if</span> (mesh) {</div><div class="line">        </div><div class="line">        _dim  = 3;</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">        radial_divs_chord  = _input(<span class="stringliteral">&quot;radial_divs_chord&quot;</span>, <span class="stringliteral">&quot;number of elements along the radial direction from mid-chord to trailing-edge&quot;</span>, 4),</div><div class="line">        radial_divs_chord_to_farfield = _input(<span class="stringliteral">&quot;radial_divs_chord_to_farfield&quot;</span>, <span class="stringliteral">&quot;number of elements along the radial direction from trailing-edge to far-field&quot;</span>, 20),</div><div class="line">        quarter_divs        = _input(<span class="stringliteral">&quot;n_quarter_elems&quot;</span>, <span class="stringliteral">&quot;number of elements in the quarter arc along the circumferencial direction&quot;</span>, 20),</div><div class="line">        spanwise_divs       = _input(<span class="stringliteral">&quot;spanwise_divs&quot;</span>, <span class="stringliteral">&quot;number of elements along the span&quot;</span>, 20),</div><div class="line">        span_to_farfield_divs= _input(<span class="stringliteral">&quot;span_to_farfield_divs&quot;</span>, <span class="stringliteral">&quot;number of elements along the spanwise direction from wing-tip to far-field&quot;</span>, 20);</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">        root_chord          = _input(<span class="stringliteral">&quot;root_chord&quot;</span>, <span class="stringliteral">&quot;chord length at thw wing root&quot;</span>, 0.5),</div><div class="line">        taper_ratio         = _input(<span class="stringliteral">&quot;taper_ratio&quot;</span>, <span class="stringliteral">&quot;ratio of chord at wing-tip to chord at root&quot;</span>, 0.5),</div><div class="line">        mid_chord_sweep     = _input(<span class="stringliteral">&quot;mid_chord_sweep&quot;</span>, <span class="stringliteral">&quot;sweep of the mid-chord in radians&quot;</span>, 0.35),</div><div class="line">        far_field_radius_to_root_chord = _input(<span class="stringliteral">&quot;far_field_radius_to_root_chord&quot;</span>, <span class="stringliteral">&quot;radial-far field distance in multiples of wing chord&quot;</span>, 15.),</div><div class="line">        span                = _input(<span class="stringliteral">&quot;span&quot;</span>, <span class="stringliteral">&quot;wing span measured along y-axis&quot;</span>, 2.),</div><div class="line">        spanwise_farfield   = _input(<span class="stringliteral">&quot;spanwise_farfield&quot;</span>, <span class="stringliteral">&quot;distance of far-field boundary along y-axis from wing root&quot;</span>, 10),</div><div class="line">        radial_elem_size_ratio = _input(<span class="stringliteral">&quot;radial_elem_size_ratio&quot;</span>, <span class="stringliteral">&quot;ratio of element radial size at far-field to the size at wing surface&quot;</span>, 10.),</div><div class="line">        spanwise_elem_size_ratio = _input(<span class="stringliteral">&quot;spanwise_elem_size_ratio&quot;</span>, <span class="stringliteral">&quot;ratio of element spanwise size at far-field to the size at wing surface&quot;</span>, 10.);</div><div class="line">        </div><div class="line">        std::string</div><div class="line">        t = _input(<span class="stringliteral">&quot;elem_type&quot;</span>, <span class="stringliteral">&quot;type of geometric element in the mesh&quot;</span>, <span class="stringliteral">&quot;hex8&quot;</span>);</div><div class="line">        </div><div class="line">        libMesh::ElemType</div><div class="line">        e_type = libMesh::Utility::string_to_enum&lt;libMesh::ElemType&gt;(t);</div></div><!-- fragment --><p> initialize the mesh </p><div class="fragment"><div class="line">    MAST::Examples::NACA0012WingMesh3D().mesh(root_chord,</div><div class="line">                                              taper_ratio,</div><div class="line">                                              mid_chord_sweep,</div><div class="line">                                              far_field_radius_to_root_chord,</div><div class="line">                                              span,</div><div class="line">                                              spanwise_farfield,</div><div class="line">                                              radial_divs_chord,</div><div class="line">                                              radial_divs_chord_to_farfield,</div><div class="line">                                              quarter_divs,</div><div class="line">                                              spanwise_divs,</div><div class="line">                                              span_to_farfield_divs,</div><div class="line">                                              radial_elem_size_ratio,</div><div class="line">                                              spanwise_elem_size_ratio,</div><div class="line">                                              *_mesh,</div><div class="line">                                              e_type);</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (bc) {</div><div class="line">    </div><div class="line">    libmesh_assert(_flight_cond);</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    if_viscous = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ae890062dad6033d1853ddd9673e6e764">if_viscous</a>;</div></div><!-- fragment --><p> create the boundary conditions for slip-wall, symmetry and far-field </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a></div><div class="line">*far_field   = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a972c0a76e95febf5fa4062c14e894eed">MAST::FAR_FIELD</a>),</div><div class="line">*symmetry    = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a2e0e3d4e05bf3d344d4ca55f6ae1070a">MAST::SYMMETRY_WALL</a>),</div></div><!-- fragment --><p> if a viscous analysis is requested then set the wall to be a no-slip wall. Otherwise, use a slip wall for inviscid analysis </p><div class="fragment"><div class="line">*wall        = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(if_viscous?</div><div class="line">                                               <a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a5955b770b5761404b3105f0158cd4d74">MAST::NO_SLIP_WALL</a>:</div><div class="line">                                               <a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a446acb4f34e709dc5f00a484427bc0a1">MAST::SLIP_WALL</a>);</div></div><!-- fragment --><p> wing surface is boundary id 4 ... </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   4, *wall);      <span class="comment">// wing surface</span></div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   0, *symmetry);  <span class="comment">// root</span></div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   2, *far_field); <span class="comment">// radial  far-field</span></div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   5, *far_field); <span class="comment">// spanwise farfield</span></div></div><!-- fragment --><p> store the pointers for later deletion in the destructor </p><div class="fragment"><div class="line">        _boundary_conditions.insert(far_field);</div><div class="line">        _boundary_conditions.insert(symmetry);</div><div class="line">        _boundary_conditions.insert(wall);</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="mfu_mesh"></a>
Minimal Flow Unit</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_minimal_flow_unit(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (mesh) {</div><div class="line">        </div><div class="line">        libmesh_assert(_sys);</div><div class="line">        </div><div class="line">        _dim  = 3;</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">        streamline_divs  = _input(<span class="stringliteral">&quot;streamline_divs&quot;</span>, <span class="stringliteral">&quot;number of elements along the streamwise direction&quot;</span>, 20),</div><div class="line">        crossflow_divs   = _input(<span class="stringliteral">&quot;crossflow_divs&quot;</span>, <span class="stringliteral">&quot;number of elements along the crossflow direction&quot;</span>,   20),</div><div class="line">        height_divs      = _input(<span class="stringliteral">&quot;height_divs&quot;</span>, <span class="stringliteral">&quot;number of elements along the height&quot;</span>, 20);</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">        pi               = acos(-1.),</div><div class="line">        length           = _input(<span class="stringliteral">&quot;length&quot;</span>, <span class="stringliteral">&quot;streamwise length of flow unit&quot;</span>, pi),</div><div class="line">        width            = _input(<span class="stringliteral">&quot;width&quot;</span>, <span class="stringliteral">&quot;crossflow width of the flow unit&quot;</span>, 0.34*pi),</div><div class="line">        height           = _input(<span class="stringliteral">&quot;height&quot;</span>, <span class="stringliteral">&quot;distance between upper and lower walls&quot;</span>, 2.);</div></div><!-- fragment --><p> initialize the periodic boundary conditions libMesh numbering: 0 -&gt; back &ndash; along z 1 -&gt; bottom &ndash; along y 2 -&gt; right &ndash; along x 3 -&gt; top &ndash; along y 4 -&gt; left &ndash; along x 5 -&gt; front &ndash; along z </p><div class="fragment"><div class="line">libMesh::PeriodicBoundary</div><div class="line">*periodic_streamwise = <span class="keyword">new</span> libMesh::PeriodicBoundary(libMesh::Point(length, 0., 0.)),</div><div class="line">*periodic_crossflow  = <span class="keyword">new</span> libMesh::PeriodicBoundary(libMesh::Point(0.,  width, 0.));</div></div><!-- fragment --><p> left,right along x-axis </p><div class="fragment"><div class="line">periodic_streamwise-&gt;myboundary     = 4;</div><div class="line">periodic_streamwise-&gt;pairedboundary = 2;</div></div><!-- fragment --><p> bottom-top along y-axis </p><div class="fragment"><div class="line">periodic_crossflow-&gt;myboundary      = 1;</div><div class="line">periodic_crossflow-&gt;pairedboundary  = 3;</div><div class="line"></div><div class="line">_sys-&gt;get_dof_map().add_periodic_boundary(*periodic_streamwise);</div><div class="line">_sys-&gt;get_dof_map().add_periodic_boundary(*periodic_crossflow);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">std::string</div><div class="line">t = _input(<span class="stringliteral">&quot;elem_type&quot;</span>, <span class="stringliteral">&quot;type of geometric element in the mesh&quot;</span>, <span class="stringliteral">&quot;hex8&quot;</span>);</div><div class="line"></div><div class="line">libMesh::ElemType</div><div class="line">e_type = libMesh::Utility::string_to_enum&lt;libMesh::ElemType&gt;(t);</div></div><!-- fragment --><p> initialize the mesh </p><div class="fragment"><div class="line">    libMesh::MeshTools::Generation::build_cube(*_mesh,</div><div class="line">                                               streamline_divs,</div><div class="line">                                               crossflow_divs,</div><div class="line">                                               height_divs,</div><div class="line">                                               -length/2., length/2.,</div><div class="line">                                               -width/2.,   width/2.,</div><div class="line">                                               -height/2., height/2.,</div><div class="line">                                               e_type);</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (bc) {</div><div class="line">    </div><div class="line">    libmesh_assert(_flight_cond);</div></div><!-- fragment --><p> this assumes a viscous analysis </p><div class="fragment"><div class="line">libmesh_assert(_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ae890062dad6033d1853ddd9673e6e764">if_viscous</a>);</div></div><!-- fragment --><p> libMesh numbering: 0 -&gt; back &ndash; along z 1 -&gt; bottom &ndash; along y 2 -&gt; right &ndash; along x 3 -&gt; top &ndash; along y 4 -&gt; left &ndash; along x 5 -&gt; front &ndash; along z </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a></div><div class="line">*dirichlet_bottom = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a>,</div><div class="line">*dirichlet_top    = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html">MAST::DirichletBoundaryCondition</a>;</div><div class="line"></div><div class="line">std::vector&lt;unsigned int&gt; constrained_vars(3);</div><div class="line">constrained_vars[0] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[1];</div><div class="line">constrained_vars[1] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[2];</div><div class="line">constrained_vars[2] = _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#ac131e1b41eae1e9d0a0f2ce4efe02c15">vars</a>()[3];</div><div class="line">dirichlet_bottom-&gt;<a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html#a7fe64cf8537780d8b6c89294e3dc3cde">init</a> (0, constrained_vars);</div><div class="line">dirichlet_top-&gt;<a class="code" href="class_m_a_s_t_1_1_dirichlet_boundary_condition.html#a7fe64cf8537780d8b6c89294e3dc3cde">init</a>    (5, constrained_vars);</div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#af0b4df38f1d01ceb173ba58da2112ba0">add_dirichlet_bc</a>(0, *dirichlet_bottom);</div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#af0b4df38f1d01ceb173ba58da2112ba0">add_dirichlet_bc</a>(5, *dirichlet_top);</div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a3e36617407739da87126767cb4af09f9">init_system_dirichlet_bc</a>(*_sys);</div></div><!-- fragment --><p> create the boundary conditions for slip-wall, symmetry and far-field </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a></div><div class="line">*wall        = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a5955b770b5761404b3105f0158cd4d74">MAST::NO_SLIP_WALL</a>);</div></div><!-- fragment --><p> libMesh defines back/front along the z-axis </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   0, *wall);      <span class="comment">// back</span></div><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   5, *wall);      <span class="comment">// front</span></div></div><!-- fragment --><p> store the pointers for later deletion in the destructor </p><div class="fragment"><div class="line">        _boundary_conditions.insert(wall);</div><div class="line">        _boundary_conditions.insert(dirichlet_top);</div><div class="line">        _boundary_conditions.insert(dirichlet_bottom);</div><div class="line">    }</div><div class="line">    </div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="panel_2d_mesh"></a>
Two-dimensional Panel Flow</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_panel_2D(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (mesh) {</div><div class="line">        </div><div class="line">        _dim                 = 2;</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">        nx_divs             = 3,</div><div class="line">        ny_divs             = 1,</div><div class="line">        n_divs_ff_to_panel  = _input(<span class="stringliteral">&quot;n_divs_farfield_to_panel&quot;</span>, <span class="stringliteral">&quot;number of element divisions from far-field to panel&quot;</span>, 30),</div><div class="line">        n_divs_panel        = _input(<span class="stringliteral">&quot;n_divs_panel&quot;</span>, <span class="stringliteral">&quot;number of element divisions on panel&quot;</span>, 10);</div><div class="line">        </div><div class="line">        <span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">        length              = _input(<span class="stringliteral">&quot;panel_l&quot;</span>,                                     <span class="stringliteral">&quot;length of panel&quot;</span>,  0.3),</div><div class="line">        tc                  = _input(<span class="stringliteral">&quot;t_by_c&quot;</span>,                                      <span class="stringliteral">&quot;length of panel&quot;</span>,  0.05),</div><div class="line">        ff_to_panel_l       = _input(<span class="stringliteral">&quot;farfield_to_l_ratio&quot;</span>, <span class="stringliteral">&quot;Ratio of distance of farfield boundary to panel length&quot;</span>,  5.0),</div><div class="line">        ff_to_panel_e_size  = _input(<span class="stringliteral">&quot;farfield_to_panel_elem_size_ratio&quot;</span>, <span class="stringliteral">&quot;Ratio of element size at far-field to element size at panel&quot;</span>,  20.0);</div><div class="line"></div><div class="line">        std::string</div><div class="line">        s                   = _input(<span class="stringliteral">&quot;elem_type&quot;</span>,  <span class="stringliteral">&quot;type of geometric element in the fluid mesh&quot;</span>,     <span class="stringliteral">&quot;quad4&quot;</span>);</div><div class="line">        libMesh::ElemType</div><div class="line">        elem_type           = libMesh::Utility::string_to_enum&lt;libMesh::ElemType&gt;(s);</div><div class="line"></div><div class="line">        std::vector&lt;Real&gt;</div><div class="line">        x_div_loc           = {-length*ff_to_panel_l, 0., length, length*(1.+ff_to_panel_l)},</div><div class="line">        x_relative_dx       = {ff_to_panel_e_size, 1., 1., ff_to_panel_e_size},</div><div class="line">        y_div_loc           = {0., length*ff_to_panel_l},</div><div class="line">        y_relative_dx       = {1., ff_to_panel_e_size};</div><div class="line">        </div><div class="line">        std::vector&lt;unsigned int&gt;</div><div class="line">        x_divs              = {n_divs_ff_to_panel, n_divs_panel, n_divs_ff_to_panel},</div><div class="line">        y_divs              = {n_divs_ff_to_panel};</div><div class="line">        </div><div class="line">        MAST::MeshInitializer::CoordinateDivisions</div><div class="line">        x_coord_divs,</div><div class="line">        y_coord_divs;</div><div class="line">        </div><div class="line">        x_coord_divs.init(nx_divs, x_div_loc, x_relative_dx, x_divs);</div><div class="line">        y_coord_divs.init(ny_divs, y_div_loc, y_relative_dx, y_divs);</div><div class="line">        </div><div class="line">        std::vector&lt;MAST::MeshInitializer::CoordinateDivisions*&gt;</div><div class="line">        divs = {&amp;x_coord_divs, &amp;y_coord_divs};</div></div><!-- fragment --><p> initialize the mesh </p><div class="fragment"><div class="line">    MAST::PanelMesh2D().init(tc,               <span class="comment">// t/c</span></div><div class="line">                             <span class="keyword">false</span>,            <span class="comment">// if cos bump</span></div><div class="line">                             1,                <span class="comment">// n max bumps</span></div><div class="line">                             divs,</div><div class="line">                             *_mesh,</div><div class="line">                             elem_type);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (bc) {</div></div><!-- fragment --><p> create the boundary conditions for slip-wall, symmetry and far-field </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a></div><div class="line">*far_field   = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a972c0a76e95febf5fa4062c14e894eed">MAST::FAR_FIELD</a>),</div><div class="line">*symm_wall   = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a2e0e3d4e05bf3d344d4ca55f6ae1070a">MAST::SYMMETRY_WALL</a>),</div><div class="line">*slip_wall   = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_boundary_condition_base.html">MAST::BoundaryConditionBase</a>(<a class="code" href="namespace_m_a_s_t.html#aad73c2614379df860d42999aa0811e14a446acb4f34e709dc5f00a484427bc0a1">MAST::SLIP_WALL</a>);</div></div><!-- fragment --><p> For Euler flow the panel is modeled with slip wall ... </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   4, *slip_wall);</div></div><!-- fragment --><p> ... and the remaining boundary on the bottom of the flow domain is modeled using symmetry wall </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(   5, *symm_wall);</div></div><!-- fragment --><p> all other boundary (right, top, left) are modeled as far-field conditions. </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=1; i&lt;=3; i++)</div><div class="line">    _discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_physics_discipline_base.html#a267ace92e7e60602d40ad3e2adf12ceb">add_side_load</a>(i, *far_field);</div></div><!-- fragment --><p> store the pointers for later deletion in the destructor </p><div class="fragment"><div class="line">        _boundary_conditions.insert(far_field);</div><div class="line">        _boundary_conditions.insert(symm_wall);</div><div class="line">        _boundary_conditions.insert(slip_wall);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> _init_panel_3D(<span class="keywordtype">bool</span> mesh, <span class="keywordtype">bool</span> bc) {</div><div class="line"></div><div class="line">    libmesh_error(); <span class="comment">// to be implemented</span></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="fluid_sol_init"></a>
Initialization of solution</h1>
<h2><a class="anchor" id="initial_sol"></a>
Initial solution</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _init_solution() {</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    restart = _input(<span class="stringliteral">&quot;restart_simulation&quot;</span>, <span class="stringliteral">&quot;restart simulation from solution&quot;</span>, <span class="keyword">false</span>);</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (!restart) {</div><div class="line">        </div><div class="line">        std::string</div><div class="line">        type = _input(<span class="stringliteral">&quot;initial_solution&quot;</span>, <span class="stringliteral">&quot;initial solution field (uniform, random, shock)&quot;</span>, <span class="stringliteral">&quot;uniform&quot;</span>);</div><div class="line"></div><div class="line">        <a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a> s = RealVectorX::Zero(_dim+2);</div><div class="line">        s(0) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#adacb8be0492216b2d1221f068b40a635">rho</a>();</div><div class="line">        s(1) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a9f48602f9d934d032aed6055c9d0bf4b">rho_u1</a>();</div><div class="line">        s(2) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a48f8845eb1157c63bbae15ee35462bbc">rho_u2</a>();</div><div class="line">        <span class="keywordflow">if</span> (_dim &gt; 2)</div><div class="line">            s(3) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a9e4bd395366e4a43bcf77c7d7cb69fb9">rho_u3</a>();</div><div class="line">        s(_dim+1) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a704c03b0b71a5ab3c1ac383d1b62b2f2">rho_e</a>();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;uniform&quot;</span>)</div></div><!-- fragment --><p> uniform solution </p><div class="fragment"><div class="line">                _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#a4a583d9bf19db839265dff485a17cb25">initialize_solution</a>(s);</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;shock&quot;</span>) {</div><div class="line"></div><div class="line">                <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">                beta   = _input(<span class="stringliteral">&quot;beta&quot;</span>, <span class="stringliteral">&quot;initial shock angle (deg)&quot;</span>, 34.799),</div><div class="line">                frac   = _input(<span class="stringliteral">&quot;shock_location_fraction&quot;</span>, <span class="stringliteral">&quot;location of shock location on panel as a fraction of panel length&quot;</span>, 0.5),</div><div class="line">                length = _input(<span class="stringliteral">&quot;panel_l&quot;</span>,                                     <span class="stringliteral">&quot;length of panel&quot;</span>,  0.3);</div><div class="line">;</div><div class="line">                ShockImpingementSolutions</div><div class="line">                *f_sol = <span class="keyword">new</span> ShockImpingementSolutions(_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a92b01d0be8918227a715c96de3ebf3a3">cp</a>,</div><div class="line">                                                       _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a0447c63ba1e7d31a6fa4b8ad6fed9c6b">cv</a>,</div><div class="line">                                                       _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ac6c069ed04c2eb39a08c128fdbda03ee">mach</a>,</div><div class="line">                                                       _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ac689842845c17faac68825f77a14087b">rho</a>,</div><div class="line">                                                       _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#afa0d31c3e80e53912988ffaa34048d2b">T</a>,</div><div class="line">                                                       beta*acos(-1)/180.,</div><div class="line">                                                       frac*length);</div><div class="line">                _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a4a234d11cf5565ac943b0940cec5d444">inf_sol</a>.reset(f_sol);</div><div class="line">                </div><div class="line">                _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#a4a583d9bf19db839265dff485a17cb25">initialize_solution</a>(*f_sol);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">&quot;random&quot;</span>) {</div><div class="line">                </div><div class="line">                <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">                amplitude = _input(<span class="stringliteral">&quot;perturb_amplitude&quot;</span>, <span class="stringliteral">&quot;maximum amplitude of velocity perturbation as fraction of velocity magnitude&quot;</span>, 0.1),</div><div class="line">                delta     = amplitude * _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a34d5b74a2c8bbeee63b9d5fa00b67a78">velocity_magnitude</a>();</div><div class="line">                </div><div class="line">                <span class="keyword">class </span>RandomVelocityPerturbationSolution:</div><div class="line">                <span class="keyword">public</span> <a class="code" href="class_m_a_s_t_1_1_field_function.html">MAST::FieldFunction</a>&lt;RealVectorX&gt; {</div><div class="line">                    </div><div class="line">                <span class="keyword">protected</span>:</div><div class="line">                    </div><div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                 _dim;</div><div class="line">                    <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a>                         _delta;</div><div class="line">                    <span class="keyword">const</span> <a class="code" href="class_m_a_s_t_1_1_flight_condition.html">MAST::FlightCondition</a> &amp;_flt;</div><div class="line">                    </div><div class="line">                <span class="keyword">public</span>:</div><div class="line">                    </div><div class="line">                    RandomVelocityPerturbationSolution(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim, <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a> delta, <span class="keyword">const</span> <a class="code" href="class_m_a_s_t_1_1_flight_condition.html">MAST::FlightCondition</a>&amp; flt):</div><div class="line">                    <a class="code" href="namespace_m_a_s_t.html">MAST</a>::FieldFunction&lt;<a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a>&gt;(<span class="stringliteral">&quot;sol&quot;</span>), _dim(dim), _delta(delta), _flt(flt) { }</div><div class="line">                    </div><div class="line">                    <span class="keyword">virtual</span> ~RandomVelocityPerturbationSolution() { }</div><div class="line">                    </div><div class="line">                    <span class="keyword">virtual</span> <span class="keywordtype">void</span></div><div class="line">                    <a class="code" href="class_m_a_s_t_1_1_field_function.html#a7cb4d8f802f494b1504243e3aa2d7fe3">operator()</a>(<span class="keyword">const</span> libMesh::Point&amp; p, <span class="keyword">const</span> <a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a> t, <a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a>&amp; v)<span class="keyword"> const </span>{</div><div class="line">                        <a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a></div><div class="line">                        r     = _delta * _flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#adacb8be0492216b2d1221f068b40a635">rho</a>() * RealVectorX::Random(_dim);</div><div class="line">                        v     = RealVectorX::Zero(_dim+2);</div><div class="line">                        v(0) = _flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#adacb8be0492216b2d1221f068b40a635">rho</a>();</div><div class="line">                        v(1) = _flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a9f48602f9d934d032aed6055c9d0bf4b">rho_u1</a>() + r(0);</div><div class="line">                        v(2) = _flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a48f8845eb1157c63bbae15ee35462bbc">rho_u2</a>() + r(1);</div><div class="line">                        <span class="keywordflow">if</span> (_dim &gt; 2)</div><div class="line">                            v(3) = _flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a9e4bd395366e4a43bcf77c7d7cb69fb9">rho_u3</a>() + r(2);</div></div><!-- fragment --><p> updated KE </p><div class="fragment"><div class="line"><a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">ke = 0.;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;_dim; i++) ke += std::pow(v(i+1)/v(0), 2);</div><div class="line">ke = 0.5 * v(0) * std::pow(ke, 0.5);</div></div><!-- fragment --><p> update the kinetic energy with the random perturbation </p><div class="fragment"><div class="line">                    v(_dim+1) = (_flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a704c03b0b71a5ab3c1ac383d1b62b2f2">rho_e</a>() - _flt.<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a329258a44749a85a3715579755379878">q0</a>() + ke);</div><div class="line">                }</div><div class="line">            };</div><div class="line">            </div><div class="line">            _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#a4a583d9bf19db839265dff485a17cb25">initialize_solution</a>(RandomVelocityPerturbationSolution(_dim,</div><div class="line">                                                                              delta,</div><div class="line">                                                                              *_flight_cond));</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            libmesh_error_msg(<span class="stringliteral">&quot;Unknown initial solution type: &quot;</span>+type);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        </div><div class="line">        std::string</div><div class="line">        output_name = _input(<span class="stringliteral">&quot;output_file_root&quot;</span>, <span class="stringliteral">&quot;prefix of output file names&quot;</span>, <span class="stringliteral">&quot;output&quot;</span>),</div><div class="line">        dir_name    = _input(<span class="stringliteral">&quot;output_file_dir&quot;</span>, <span class="stringliteral">&quot;directory in which solution vector is stored&quot;</span>, <span class="stringliteral">&quot;data&quot;</span>);</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">        t_step      = _input(<span class="stringliteral">&quot;restart_time_step&quot;</span>, <span class="stringliteral">&quot;time-step to restart solution&quot;</span>, 0);</div><div class="line">        </div><div class="line">        </div><div class="line">        std::ostringstream oss;</div><div class="line">        oss &lt;&lt; output_name &lt;&lt; <span class="stringliteral">&quot;_sol_t_&quot;</span> &lt;&lt; t_step;</div><div class="line">        _sys-&gt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a33394a268fa6b0353b9df944ab53c7c9">read_in_vector</a>(*_sys-&gt;solution, dir_name, oss.str(), <span class="keyword">true</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="initial_sens_sol"></a>
Initial sensitivity solution</h2>
<div class="fragment"><div class="line">   <span class="keywordtype">void</span> _init_sensitivity_solution() {</div><div class="line">       </div><div class="line">       <span class="keywordtype">bool</span></div><div class="line">       restart = _input(<span class="stringliteral">&quot;restart_simulation&quot;</span>, <span class="stringliteral">&quot;restart simulation from solution&quot;</span>, <span class="keyword">false</span>);</div><div class="line">       </div><div class="line">       <span class="keywordflow">if</span> (!restart) {</div><div class="line">           </div><div class="line">           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">           n = _mesh-&gt;mesh_dimension();</div><div class="line">           <a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a> s = RealVectorX::Zero(n+2);</div><div class="line">           <span class="comment">/*s(0) = 0.;</span></div><div class="line"><span class="comment">           s(1) = _flight_cond-&gt;rho_u1_sens_mach();</span></div><div class="line"><span class="comment">           s(2) = _flight_cond-&gt;rho_u2_sens_mach();</span></div><div class="line"><span class="comment">* </span></div></div><!-- fragment --><p> if (n &gt; 2) s(3) = _flight_cond-&gt;rho_u3_sens_mach(); </p><div class="fragment"><div class="line">s(n+1) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ad4c9fa40171658b89506eb5a964b57ef">rho_e_sens_mach</a>();*/</div><div class="line">s(0) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#abfcde6682b2f4bb8efe0aea188b4cffb">rho_sens_rho</a>();</div><div class="line">s(1) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#af66d2b702cf5f4374bcfdca0c1c86a7e">rho_u1_sens_rho</a>();</div><div class="line">s(2) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a9c8dc35bf200b4e67f650008a16d5a74">rho_u2_sens_rho</a>();</div></div><!-- fragment --><p> if (n &gt; 2) s(3) = _flight_cond-&gt;rho_u3_sens_mach(); </p><div class="fragment"><div class="line">            s(n+1) = _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a221413754f37e82ecbd81d11f9c04144">rho_e_sens_rho</a>();</div><div class="line">            </div><div class="line">            _sys_init-&gt;<a class="code" href="class_m_a_s_t_1_1_system_initialization.html#a4a583d9bf19db839265dff485a17cb25">initialize_solution</a>(s);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            </div><div class="line">            _sys-&gt;solution-&gt;zero();</div><div class="line">            _sys-&gt;solution-&gt;close();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div></div><!-- fragment --> <h1><a class="anchor" id="flow_analysis_class"></a>
Example class</h1>
<h2><a class="anchor" id="flow_analysis_class_constructor"></a>
Constructor</h2>
<div class="fragment"><div class="line">FlowAnalysis(libMesh::LibMeshInit&amp; init,</div><div class="line">             MAST::Examples::GetPotWrapper&amp; input):</div><div class="line">_init           (init),</div><div class="line">_input          (input),</div><div class="line">_dim            (0),</div><div class="line">_mesh           (nullptr),</div><div class="line">_eq_sys         (nullptr),</div><div class="line">_sys            (nullptr),</div><div class="line">_sys_init       (nullptr),</div><div class="line">_discipline     (nullptr),</div><div class="line">_flight_cond    (nullptr),</div><div class="line">_output         (nullptr) {</div><div class="line"></div><div class="line"></div><div class="line">    _mesh              = <span class="keyword">new</span> libMesh::ParallelMesh(_init.comm());</div></div><!-- fragment --><p> create equation system </p><div class="fragment"><div class="line">_eq_sys = <span class="keyword">new</span> libMesh::EquationSystems(*_mesh);</div></div><!-- fragment --><p> add the system to be used for fluid analysis </p><div class="fragment"><div class="line">_sys = &amp;(_eq_sys-&gt;add_system&lt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html">MAST::NonlinearSystem</a>&gt;(<span class="stringliteral">&quot;fluid&quot;</span>));</div><div class="line">_sys-&gt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#aec5119fa1133da743242d784b591341f">set_init_B_matrix</a>();</div></div><!-- fragment --><p> initialize the mesh. Details of parameters for each mesh are described above. </p><div class="fragment"><div class="line">_init_mesh(<span class="keyword">true</span>, <span class="keyword">false</span>);</div></div><!-- fragment --><p> create the discipline where boundary conditions will be stored </p><div class="fragment"><div class="line">_discipline = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_conservative_fluid_discipline.html">MAST::ConservativeFluidDiscipline</a>(*_eq_sys);</div></div><!-- fragment --><p> create system initialization object to add variables </p><div class="fragment"><div class="line">std::string s;</div><div class="line">s                   = input(<span class="stringliteral">&quot;fe_order&quot;</span>, <span class="stringliteral">&quot;order of finite element shape basis functions&quot;</span>,     <span class="stringliteral">&quot;first&quot;</span>);</div><div class="line">libMesh::Order</div><div class="line">fe_order            = libMesh::Utility::string_to_enum&lt;libMesh::Order&gt;(s);</div><div class="line">s                   = input(<span class="stringliteral">&quot;fe_family&quot;</span>,      <span class="stringliteral">&quot;family of finite element shape functions&quot;</span>, <span class="stringliteral">&quot;lagrange&quot;</span>);</div><div class="line">libMesh::FEFamily</div><div class="line">fe_family           = libMesh::Utility::string_to_enum&lt;libMesh::FEFamily&gt;(s);</div><div class="line"></div><div class="line">_sys_init = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_conservative_fluid_system_initialization.html">MAST::ConservativeFluidSystemInitialization</a>(*_sys,</div><div class="line">                                                            _sys-&gt;name(),</div><div class="line">                                                            libMesh::FEType(fe_order, fe_family),</div><div class="line">                                                            _dim);</div></div><!-- fragment --><p> set fluid properties </p><div class="fragment"><div class="line">_flight_cond = <span class="keyword">new</span> <a class="code" href="class_m_a_s_t_1_1_flight_condition.html">MAST::FlightCondition</a>;</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a4f176e2d606ac85dcd7c72279ff3968a">flow_unit_vector</a>(0)  =</div><div class="line">_input(<span class="stringliteral">&quot;flow_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of flow&quot;</span>, 1., 0);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a4f176e2d606ac85dcd7c72279ff3968a">flow_unit_vector</a>(1)  =</div><div class="line">_input(<span class="stringliteral">&quot;flow_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of flow&quot;</span>, 0., 1);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a4f176e2d606ac85dcd7c72279ff3968a">flow_unit_vector</a>(2)  =</div><div class="line">_input(<span class="stringliteral">&quot;flow_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of flow&quot;</span>, 0., 2);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ac6c069ed04c2eb39a08c128fdbda03ee">mach</a>             = input(<span class="stringliteral">&quot;mach&quot;</span>, <span class="stringliteral">&quot;fluid Mach number&quot;</span>,                           0.5);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a92b01d0be8918227a715c96de3ebf3a3">cp</a>  = input(<span class="stringliteral">&quot;cp&quot;</span>,   <span class="stringliteral">&quot;fluid specific heat at constant pressure&quot;</span>,  1003.);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a0447c63ba1e7d31a6fa4b8ad6fed9c6b">cv</a>  = input(<span class="stringliteral">&quot;cv&quot;</span>,   <span class="stringliteral">&quot;fluid specific heat at constant volume&quot;</span>,     716.);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#afa0d31c3e80e53912988ffaa34048d2b">T</a>   = input(<span class="stringliteral">&quot;T&quot;</span>,    <span class="stringliteral">&quot;fluid absolute temperature&quot;</span>,                 300.);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ac689842845c17faac68825f77a14087b">rho</a> = input(<span class="stringliteral">&quot;rho&quot;</span>,  <span class="stringliteral">&quot;fluid density&quot;</span>,                              1.05);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ae890062dad6033d1853ddd9673e6e764">if_viscous</a> =</div><div class="line">_input(<span class="stringliteral">&quot;if_viscous&quot;</span>, <span class="stringliteral">&quot;if the flow analysis should include viscosity&quot;</span>, <span class="keyword">false</span>);</div><div class="line">_flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ad3162d50c07ce8f9eba961d09164a93d">init</a>();</div></div><!-- fragment --><p> tell the discipline about the fluid values </p><div class="fragment"><div class="line">_discipline-&gt;<a class="code" href="class_m_a_s_t_1_1_conservative_fluid_discipline.html#af42836a80dfa6998a8ed7af07899d0cd">set_flight_condition</a>(*_flight_cond);</div></div><!-- fragment --><p> initialize the boundary conditions before initialization of the equation system </p><div class="fragment"><div class="line">_init_mesh(<span class="keyword">false</span>, <span class="keyword">true</span>);</div></div><!-- fragment --><p> initialize the equation system </p><div class="fragment"><div class="line">_eq_sys-&gt;init();</div></div><!-- fragment --><p> print the information </p><div class="fragment"><div class="line">_mesh-&gt;print_info();</div><div class="line">_eq_sys-&gt;print_info();</div></div><!-- fragment --><p> initialize the fluid solution </p><div class="fragment"><div class="line">    _init_solution();</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="flow_analysis_class_destructor"></a>
Destructor</h2>
<div class="fragment"><div class="line">~FlowAnalysis() {</div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> _eq_sys;</div><div class="line">    <span class="keyword">delete</span> _mesh;</div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> _discipline;</div><div class="line">    <span class="keyword">delete</span> _sys_init;</div><div class="line">    <span class="keyword">delete</span> _flight_cond;</div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> _output;</div><div class="line"></div><div class="line">    {</div><div class="line">        std::set&lt;MAST::BoundaryConditionBase*&gt;::iterator</div><div class="line">        it   = _boundary_conditions.begin(),</div><div class="line">        end  = _boundary_conditions.end();</div><div class="line">        <span class="keywordflow">for</span> ( ; it!=end; it++)</div><div class="line">            <span class="keyword">delete</span> *it;</div><div class="line">    }</div><div class="line"></div><div class="line">    {</div><div class="line">        std::set&lt;libMesh::PeriodicBoundary*&gt;::iterator</div><div class="line">        it   = _periodic_boundaries.begin(),</div><div class="line">        end  = _periodic_boundaries.end();</div><div class="line">        <span class="keywordflow">for</span> ( ; it!=end; it++)</div><div class="line">            <span class="keyword">delete</span> *it;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> <h1><a class="anchor" id="flow_computation"></a>
Computation</h1>
<h2><a class="anchor" id="flow_transient_analysis"></a>
Transient analysis</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> compute_flow() {</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    output     = _input(<span class="stringliteral">&quot;if_output&quot;</span>, <span class="stringliteral">&quot;if write output to a file&quot;</span>, <span class="keyword">true</span>);</div><div class="line">    std::string</div><div class="line">    output_name = _input(<span class="stringliteral">&quot;output_file_root&quot;</span>, <span class="stringliteral">&quot;prefix of output file names&quot;</span>, <span class="stringliteral">&quot;output&quot;</span>),</div><div class="line">    transient_output_name = output_name + <span class="stringliteral">&quot;_transient.exo&quot;</span>;</div></div><!-- fragment --><p> create the nonlinear assembly object </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_transient_assembly.html">MAST::TransientAssembly</a>                                  assembly;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_conservative_fluid_transient_assembly_elem_operations.html">MAST::ConservativeFluidTransientAssemblyElemOperations</a>   elem_ops;</div><div class="line">MAST::FirstOrderNewmarkTransientSolver                   solver;</div><div class="line"><a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a></div><div class="line">nvec = RealVectorX::Zero(3);</div><div class="line">nvec(0) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 1., 0);</div><div class="line">nvec(1) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 0., 1);</div><div class="line">nvec(2) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 0., 2);</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_integrated_force_output.html">MAST::IntegratedForceOutput</a>                              force(nvec);</div><div class="line">std::set&lt;libMesh::boundary_id_type&gt; bids;</div><div class="line">bids.insert(3);</div><div class="line">force.set_participating_boundaries(bids);</div><div class="line"></div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0644e12cd53adc64d9b7e027becc08b5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">force.set_discipline_and_system(*_discipline, *_sys_init);</div><div class="line">solver.set_discipline_and_system(*_discipline, *_sys_init);</div><div class="line">solver.set_elem_operation_object(elem_ops);</div></div><!-- fragment --><p> this-&gt;initialize_solution(); </p><div class="fragment"></div><!-- fragment --><p> file to write the solution for visualization </p><div class="fragment"><div class="line">libMesh::ExodusII_IO transient_output(*_mesh);</div><div class="line">std::ofstream force_output;</div><div class="line">force_output.open(<span class="stringliteral">&quot;force.txt&quot;</span>);</div><div class="line">force_output</div><div class="line">&lt;&lt; std::setw(10) &lt;&lt; <span class="stringliteral">&quot;t&quot;</span></div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; <span class="stringliteral">&quot;force&quot;</span> &lt;&lt; std::endl;</div></div><!-- fragment --><p> time solver parameters </p><div class="fragment"><div class="line"><a class="code" href="mast__data__types_8h.html#a0fc21c6ff882da286a44d42c85f5378f">Real</a></div><div class="line">factor   = 0.,</div><div class="line">min_fac  = 1.5,</div><div class="line">vel_0    = 0.,</div><div class="line">vel_1    = 1.e12,</div><div class="line">p        = 0.5,</div><div class="line">tval     = 0.,</div><div class="line">max_dt   = _input(<span class="stringliteral">&quot;max_dt&quot;</span>, <span class="stringliteral">&quot;maximum time-step size&quot;</span>, 1.e-1);</div><div class="line"></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">t_step            = 0,</div><div class="line">iter_count_dt     = 0,</div><div class="line">n_iters_change_dt = _input(<span class="stringliteral">&quot;n_iters_change_dt&quot;</span>, <span class="stringliteral">&quot;number of time-steps before dt is changed&quot;</span>, 4),</div><div class="line">n_steps           = _input(<span class="stringliteral">&quot;n_transient_steps&quot;</span>, <span class="stringliteral">&quot;number of transient time-steps&quot;</span>, 100);</div><div class="line">solver.dt         = _input(<span class="stringliteral">&quot;dt&quot;</span>, <span class="stringliteral">&quot;time-step size&quot;</span>,    1.e-3);</div></div><!-- fragment --><p> the default parameter adds some numerical damping to improve convergence towards steady state solution. </p><div class="fragment"><div class="line">solver.beta       = _input(<span class="stringliteral">&quot;beta&quot;</span>, <span class="stringliteral">&quot;Newmark solver beta parameter &quot;</span>,  0.7);</div></div><!-- fragment --><p> print the fluid values: </p><div class="fragment"><div class="line">libMesh::out</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;rho: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#adacb8be0492216b2d1221f068b40a635">rho</a>() &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;T: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#afa0d31c3e80e53912988ffaa34048d2b">T</a> &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;Mach: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#ac6c069ed04c2eb39a08c128fdbda03ee">mach</a> &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;gamma: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#ad0061c1fcea3a5221c8c273863d00041">gamma</a> &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;R: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a3190f03a5ebc042412501b37ef42e76d">R</a> &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;a: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a5f3b873710d6cb289c9649d89a903dc0">gas_property</a>.<a class="code" href="class_m_a_s_t_1_1_gas_property.html#a1ad62d566c1e3da5de3c4c490bf45a89">a</a> &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::setw(15) &lt;&lt; <span class="stringliteral">&quot;q_dyn: &quot;</span> &lt;&lt; std::setw(20) &lt;&lt; _flight_cond-&gt;<a class="code" href="class_m_a_s_t_1_1_flight_condition.html#a329258a44749a85a3715579755379878">q0</a>() &lt;&lt; std::endl</div><div class="line">&lt;&lt; std::endl;</div></div><!-- fragment --><p> ask the solver to update the initial condition for d2(X)/dt2 This is recommended only for the initial time step, since the time integration scheme updates the velocity and acceleration at each subsequent iterate </p><div class="fragment"><div class="line">solver.solve_highest_derivative_and_advance_time_step(assembly);</div></div><!-- fragment --><p> loop over time steps </p><div class="fragment"><div class="line"><span class="keywordflow">while</span> (t_step &lt; n_steps) {</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (iter_count_dt == n_iters_change_dt) {</div><div class="line">        </div><div class="line">        libMesh::out</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;Changing dt:  old dt = &quot;</span> &lt;&lt; solver.dt</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;    new dt = &quot;</span> ;</div><div class="line">        </div><div class="line">        factor        = std::pow(vel_0/vel_1, p);</div><div class="line">        factor        = std::max(factor, min_fac);</div><div class="line">        solver.dt     = std::min(solver.dt*factor, max_dt);</div><div class="line">        </div><div class="line">        libMesh::out &lt;&lt; solver.dt &lt;&lt; std::endl;</div><div class="line">        </div><div class="line">        iter_count_dt = 0;</div><div class="line">        vel_0         = vel_1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        iter_count_dt++;</div><div class="line">    </div><div class="line">    libMesh::out</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;Time step: &quot;</span>    &lt;&lt; t_step</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  t = &quot;</span>       &lt;&lt; tval</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  dt = &quot;</span>      &lt;&lt; solver.dt</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  xdot-L2 = &quot;</span> &lt;&lt; solver.velocity().l2_norm()</div><div class="line">    &lt;&lt; std::endl;</div></div><!-- fragment --><p> write the time-step </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (output) {</div><div class="line">    </div><div class="line">    transient_output.write_timestep(transient_output_name,</div><div class="line">                                    *_eq_sys,</div><div class="line">                                    t_step+1,</div><div class="line">                                    _sys-&gt;time);</div><div class="line">    std::ostringstream oss;</div><div class="line">    oss &lt;&lt; output_name &lt;&lt; <span class="stringliteral">&quot;_sol_t_&quot;</span> &lt;&lt; t_step;</div><div class="line">    _sys-&gt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#ac75cc5b1c94952fcbdd37e9372222e27">write_out_vector</a>(*_sys-&gt;solution, <span class="stringliteral">&quot;data&quot;</span>, oss.str(), <span class="keyword">true</span>);</div><div class="line">}</div></div><!-- fragment --><p> calculate the output quantity </p><div class="fragment"><div class="line">force.zero_for_analysis();</div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#abbbc4fd5c13c458b2ef6c27636ee7510">calculate_output</a>(solver.solution(), force);</div><div class="line">force_output</div><div class="line">&lt;&lt; std::setw(10) &lt;&lt; tval</div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; force.output_total() &lt;&lt; std::endl;</div></div><!-- fragment --><p> _sys-&gt;adjoint_solve(solver, force, assembly, true); _sys-&gt;solution-&gt;swap(_sys-&gt;get_adjoint_solution(0)); adjoint_output.write_timestep("adjoint.exo", *_eq_sys, t_step+1, _sys-&gt;time); _sys-&gt;solution-&gt;swap(_sys-&gt;get_adjoint_solution(0)); </p><div class="fragment"></div><!-- fragment --><p> solve for the time-step </p><div class="fragment"><div class="line">solver.solve(assembly);</div><div class="line">solver.advance_time_step();</div></div><!-- fragment --><p> update time value </p><div class="fragment"><div class="line">        tval  += solver.dt;</div><div class="line">        t_step++;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="flow_transient_sensitivity_analysis"></a>
Transient sensitivity analysis</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div><div class="line">compute_transient_sensitivity(<a class="code" href="class_m_a_s_t_1_1_parameter.html">MAST::Parameter</a>&amp; p) {</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    output                = _input(<span class="stringliteral">&quot;if_output&quot;</span>, <span class="stringliteral">&quot;if write output to a file&quot;</span>, <span class="keyword">false</span>);</div><div class="line">    std::string</div><div class="line">    output_name           = _input(<span class="stringliteral">&quot;output_file_root&quot;</span>, <span class="stringliteral">&quot;prefix of output file names&quot;</span>, <span class="stringliteral">&quot;output&quot;</span>),</div><div class="line">    transient_output_name = output_name + <span class="stringliteral">&quot;_transient_sensitivity_&quot;</span> + p.<a class="code" href="class_m_a_s_t_1_1_function_base.html#a673e80573ae59d74969d601b227545d1">name</a>() + <span class="stringliteral">&quot;.exo&quot;</span>,</div><div class="line">    nonlinear_sol_root    = output_name+std::string(<span class="stringliteral">&quot;_sol_t_&quot;</span>),</div><div class="line">    nonlinear_sol_dir     = _input(<span class="stringliteral">&quot;nonlinear_sol_dir&quot;</span>, <span class="stringliteral">&quot;directory containing the location of nonlinear solutions&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div></div><!-- fragment --><p> the output from analysis should have been saved for sensitivity </p><div class="fragment"><div class="line">libmesh_assert(output);</div></div><!-- fragment --><p> create the nonlinear assembly object </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_transient_assembly.html">MAST::TransientAssembly</a>                                  assembly;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_conservative_fluid_transient_assembly_elem_operations.html">MAST::ConservativeFluidTransientAssemblyElemOperations</a>   elem_ops;</div><div class="line">MAST::FirstOrderNewmarkTransientSolver                   solver;</div><div class="line"><a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a></div><div class="line">nvec = RealVectorX::Zero(3);</div><div class="line">nvec(0) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 1., 0);</div><div class="line">nvec(1) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 0., 1);</div><div class="line">nvec(2) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 0., 2);</div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_integrated_force_output.html">MAST::IntegratedForceOutput</a>                              force(nvec);</div><div class="line">std::set&lt;libMesh::boundary_id_type&gt; bids;</div><div class="line">bids.insert(3);</div><div class="line">force.set_participating_boundaries(bids);</div><div class="line"></div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0644e12cd53adc64d9b7e027becc08b5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">force.set_discipline_and_system(*_discipline, *_sys_init);</div><div class="line">solver.set_discipline_and_system(*_discipline, *_sys_init);</div><div class="line">solver.set_elem_operation_object(elem_ops);</div></div><!-- fragment --><p> initialize the solution to zero, or to something that the user may have provided </p><div class="fragment"><div class="line">_init_solution();</div><div class="line">_sys-&gt;solution-&gt;swap(solver.solution_sensitivity());</div><div class="line">_init_sensitivity_solution();</div><div class="line">_sys-&gt;solution-&gt;swap(solver.solution_sensitivity());</div></div><!-- fragment --><p> file to write the solution for visualization </p><div class="fragment"><div class="line">libMesh::ExodusII_IO exodus_writer(*_mesh);</div></div><!-- fragment --><p> file to write the solution for visualization </p><div class="fragment"><div class="line">libMesh::ExodusII_IO transient_output(*_mesh);</div><div class="line">std::ofstream force_output;</div><div class="line">force_output.open(<span class="stringliteral">&quot;force.txt&quot;</span>);</div><div class="line">force_output</div><div class="line">&lt;&lt; std::setw(10) &lt;&lt; <span class="stringliteral">&quot;t&quot;</span></div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; <span class="stringliteral">&quot;force&quot;</span></div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; <span class="stringliteral">&quot;force_sens&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">t_step            = 0,</div><div class="line">n_steps           = _input(<span class="stringliteral">&quot;n_transient_steps&quot;</span>, <span class="stringliteral">&quot;number of transient time-steps&quot;</span>, 100);</div><div class="line">solver.dt         = _input(<span class="stringliteral">&quot;dt&quot;</span>, <span class="stringliteral">&quot;time-step size&quot;</span>,    1.e-3);</div><div class="line">_sys-&gt;time        = _input(<span class="stringliteral">&quot;t_initial&quot;</span>, <span class="stringliteral">&quot;initial time-step&quot;</span>,    0.);</div><div class="line">solver.beta       = _input(<span class="stringliteral">&quot;beta&quot;</span>, <span class="stringliteral">&quot;Newmark solver beta parameter &quot;</span>,  0.5);</div></div><!-- fragment --><p> ask the solver to update the initial condition for d2(X)/dt2 This is recommended only for the initial time step, since the time integration scheme updates the velocity and acceleration at each subsequent iterate </p><div class="fragment"><div class="line">solver.solve_highest_derivative_and_advance_time_step_with_sensitivity(assembly, p);</div></div><!-- fragment --><p> loop over time steps </p><div class="fragment"><div class="line"><span class="keywordflow">while</span> (t_step &lt; n_steps) {</div><div class="line">    </div><div class="line">    libMesh::out</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;Time step: &quot;</span> &lt;&lt; t_step</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  t = &quot;</span> &lt;&lt; _sys-&gt;time</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  xdot-L2 = &quot;</span> &lt;&lt; solver.velocity().l2_norm()</div><div class="line">    &lt;&lt; std::endl;</div></div><!-- fragment --><p> write the time-step </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (output) {</div><div class="line">    </div><div class="line">    _sys-&gt;solution-&gt;swap(solver.solution_sensitivity());</div><div class="line">    exodus_writer.write_timestep(transient_output_name,</div><div class="line">                                 *_eq_sys,</div><div class="line">                                 t_step+1,</div><div class="line">                                 _sys-&gt;time);</div><div class="line">    _sys-&gt;solution-&gt;swap(solver.solution_sensitivity());</div><div class="line">}</div><div class="line"></div><div class="line">std::ostringstream oss;</div><div class="line">oss &lt;&lt; nonlinear_sol_root &lt;&lt; t_step;</div><div class="line">_sys-&gt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#a33394a268fa6b0353b9df944ab53c7c9">read_in_vector</a>(*_sys-&gt;solution, nonlinear_sol_dir, oss.str(), <span class="keyword">true</span>);</div><div class="line">oss &lt;&lt; <span class="stringliteral">&quot;_sens_t&quot;</span>;</div><div class="line">_sys-&gt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#ac75cc5b1c94952fcbdd37e9372222e27">write_out_vector</a>(<span class="comment">/*solver.dt, _sys-&gt;time,*/</span> solver.solution_sensitivity(), <span class="stringliteral">&quot;data&quot;</span>, oss.str(), <span class="keyword">true</span>);</div></div><!-- fragment --><p> solve for the sensitivity time-step </p><div class="fragment"><div class="line">force.zero_for_analysis();</div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#abbbc4fd5c13c458b2ef6c27636ee7510">calculate_output</a>(solver.solution(), force);</div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0c8b29a632eb1b975005798b3862ad60">calculate_output_direct_sensitivity</a>(solver.solution(), &amp;solver.solution_sensitivity(), p, force);</div><div class="line">force_output</div><div class="line">&lt;&lt; std::setw(10) &lt;&lt; _sys-&gt;time</div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; force.output_total()</div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; force.output_sensitivity_total(p) &lt;&lt; std::endl;</div><div class="line"></div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#ae1fd90ee09c6d0fcf585d10027555689">sensitivity_solve</a>(assembly, p);</div><div class="line">solver.advance_time_step_with_sensitivity();</div></div><!-- fragment --><p> update time step counter </p><div class="fragment"><div class="line">        t_step++;</div><div class="line">    }</div><div class="line">    </div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="flow_transient_stabilized_sensitivity_analysis"></a>
Transient stabilized sensitivity analysis</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div><div class="line">compute_transient_stabilized_sensitivity(<a class="code" href="class_m_a_s_t_1_1_parameter.html">MAST::Parameter</a>&amp; p) {</div><div class="line">    </div><div class="line">    <span class="keywordtype">bool</span></div><div class="line">    output                = _input(<span class="stringliteral">&quot;if_output&quot;</span>, <span class="stringliteral">&quot;if write output to a file&quot;</span>, <span class="keyword">false</span>);</div><div class="line">    std::string</div><div class="line">    output_name           = _input(<span class="stringliteral">&quot;output_file_root&quot;</span>, <span class="stringliteral">&quot;prefix of output file names&quot;</span>, <span class="stringliteral">&quot;output&quot;</span>),</div><div class="line">    transient_output_name = output_name + <span class="stringliteral">&quot;_transient_sensitivity_&quot;</span> + p.<a class="code" href="class_m_a_s_t_1_1_function_base.html#a673e80573ae59d74969d601b227545d1">name</a>() + <span class="stringliteral">&quot;.exo&quot;</span>,</div><div class="line">    nonlinear_sol_root    = output_name+std::string(<span class="stringliteral">&quot;_sol_t_&quot;</span>),</div><div class="line">    nonlinear_sol_dir     = _input(<span class="stringliteral">&quot;nonlinear_sol_dir&quot;</span>, <span class="stringliteral">&quot;directory containing the location of nonlinear solutions&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div></div><!-- fragment --><p> the output from analysis should have been saved for sensitivity </p><div class="fragment"><div class="line">libmesh_assert(output);</div></div><!-- fragment --><p> create the nonlinear assembly object </p><div class="fragment"><div class="line"><a class="code" href="class_m_a_s_t_1_1_transient_assembly.html">MAST::TransientAssembly</a>                                     assembly;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_conservative_fluid_transient_assembly_elem_operations.html">MAST::ConservativeFluidTransientAssemblyElemOperations</a>      elem_ops;</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_stabilized_first_order_newmark_transient_sensitivity_solver.html">MAST::StabilizedFirstOrderNewmarkTransientSensitivitySolver</a> solver;</div><div class="line"><a class="code" href="mast__data__types_8h.html#abc8ad2bc4221d7400e5306159e28e588">RealVectorX</a></div><div class="line">nvec = RealVectorX::Zero(3);</div><div class="line">nvec(0) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 1., 0);</div><div class="line">nvec(1) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 0., 1);</div><div class="line">nvec(2) =</div><div class="line">_input(<span class="stringliteral">&quot;force_unit_vector&quot;</span>, <span class="stringliteral">&quot;unit vector defining direction of integrated force output&quot;</span>, 0., 2);</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="class_m_a_s_t_1_1_integrated_force_output.html">MAST::IntegratedForceOutput</a>                              force(nvec);</div><div class="line">std::set&lt;libMesh::boundary_id_type&gt; bids;</div><div class="line">bids.insert(3);</div><div class="line">force.set_participating_boundaries(bids);</div><div class="line"></div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0644e12cd53adc64d9b7e027becc08b5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">elem_ops.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">force.set_discipline_and_system(*_discipline, *_sys_init);</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_assembly_elem_operations.html#affb65f707a71004834a34987f14749c5">set_discipline_and_system</a>(*_discipline, *_sys_init);</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#abaa8ec9abf4ea925208d4de9b3580798">set_elem_operation_object</a>(elem_ops);</div></div><!-- fragment --><p> file to write the solution for visualization </p><div class="fragment"><div class="line">libMesh::ExodusII_IO exodus_writer(*_mesh);</div></div><!-- fragment --><p> file to write the solution for visualization </p><div class="fragment"><div class="line">libMesh::ExodusII_IO transient_output(*_mesh);</div><div class="line">std::ofstream force_output;</div><div class="line">force_output.open(<span class="stringliteral">&quot;force.txt&quot;</span>);</div><div class="line">force_output</div><div class="line">&lt;&lt; std::setw(10) &lt;&lt; <span class="stringliteral">&quot;t&quot;</span></div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; <span class="stringliteral">&quot;force&quot;</span></div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; <span class="stringliteral">&quot;force_sens&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div><div class="line">t_step            = _input(<span class="stringliteral">&quot;initial_transient_step&quot;</span>, <span class="stringliteral">&quot;first transient step from the transient solution to be used for sensitivity&quot;</span>, 0),</div><div class="line">n_steps           = _input(<span class="stringliteral">&quot;n_transient_steps&quot;</span>, <span class="stringliteral">&quot;number of transient time-steps&quot;</span>, 100);</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#a26fa8f9a8e7085f4653395300141c770">dt</a>         = _input(<span class="stringliteral">&quot;dt&quot;</span>, <span class="stringliteral">&quot;time-step size&quot;</span>,    1.e-3);</div><div class="line">_sys-&gt;time        = _input(<span class="stringliteral">&quot;t_initial&quot;</span>, <span class="stringliteral">&quot;initial time-step&quot;</span>,    0.);</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_stabilized_first_order_newmark_transient_sensitivity_solver.html#a56b4d729fb4ac4839c48f4c9d4979987">max_amp</a>    = _input(<span class="stringliteral">&quot;max_amp&quot;</span>, <span class="stringliteral">&quot;maximum amplitude for the stabilized sensitivity solver&quot;</span>,   1.);</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_stabilized_first_order_newmark_transient_sensitivity_solver.html#aaedac37af5baa5cf192cf287fad234f3">beta</a>       = _input(<span class="stringliteral">&quot;sensitivity_beta&quot;</span>, <span class="stringliteral">&quot;beta for stabilized sensitivity solver&quot;</span>,   1.);</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_stabilized_first_order_newmark_transient_sensitivity_solver.html#a5a6914527cd5ab39354f691ffaba6f56">max_index</a>  = n_steps;</div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_stabilized_first_order_newmark_transient_sensitivity_solver.html#aabce08457b1862ba14d62e4fa3aeda4b">set_nolinear_solution_location</a>(nonlinear_sol_root, nonlinear_sol_dir);</div></div><!-- fragment --><p> ask the solver to update the initial condition for d2(X)/dt2 This is recommended only for the initial time step, since the time integration scheme updates the velocity and acceleration at each subsequent iterate </p><div class="fragment"></div><!-- fragment --><p> loop over time steps </p><div class="fragment"><div class="line"><span class="keywordflow">while</span> (t_step &lt; n_steps) {</div><div class="line">    </div><div class="line">    libMesh::out</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot;Time step: &quot;</span> &lt;&lt; t_step</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  t = &quot;</span> &lt;&lt; _sys-&gt;time</div><div class="line">    &lt;&lt; <span class="stringliteral">&quot; :  xdot-L2 = &quot;</span> &lt;&lt; solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#a811570c31eeac65775c6c54bc757aa4d">velocity</a>().l2_norm()</div><div class="line">    &lt;&lt; std::endl;</div></div><!-- fragment --><p> write the time-step </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (output) {</div><div class="line">    </div><div class="line">    _sys-&gt;solution-&gt;swap(solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#a61f2d87281dda45dbd2909f639707abc">solution_sensitivity</a>());</div><div class="line">    exodus_writer.write_timestep(transient_output_name,</div><div class="line">                                 *_eq_sys,</div><div class="line">                                 t_step+1,</div><div class="line">                                 _sys-&gt;time);</div><div class="line">    _sys-&gt;solution-&gt;swap(solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#a61f2d87281dda45dbd2909f639707abc">solution_sensitivity</a>());</div><div class="line">}</div><div class="line"></div><div class="line">std::ostringstream oss;</div><div class="line">oss &lt;&lt; output_name &lt;&lt; <span class="stringliteral">&quot;_sol_t_&quot;</span> &lt;&lt; t_step;</div><div class="line">oss &lt;&lt; <span class="stringliteral">&quot;_sens_t&quot;</span>;</div><div class="line">_sys-&gt;<a class="code" href="class_m_a_s_t_1_1_nonlinear_system.html#ac75cc5b1c94952fcbdd37e9372222e27">write_out_vector</a>(<span class="comment">/*solver.dt, _sys-&gt;time,*/</span> solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#a61f2d87281dda45dbd2909f639707abc">solution_sensitivity</a>(), <span class="stringliteral">&quot;data&quot;</span>, oss.str(), <span class="keyword">true</span>);</div></div><!-- fragment --><p> solve for the sensitivity time-step </p><div class="fragment"><div class="line">force.zero_for_analysis();</div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#abbbc4fd5c13c458b2ef6c27636ee7510">calculate_output</a>(solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#ada10cf14dba630e80954711e80495c55">solution</a>(), force);</div><div class="line">assembly.<a class="code" href="class_m_a_s_t_1_1_assembly_base.html#a0c8b29a632eb1b975005798b3862ad60">calculate_output_direct_sensitivity</a>(solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#ada10cf14dba630e80954711e80495c55">solution</a>(), &amp;solver.<a class="code" href="class_m_a_s_t_1_1_transient_solver_base.html#a61f2d87281dda45dbd2909f639707abc">solution_sensitivity</a>(), p, force);</div><div class="line">force_output</div><div class="line">&lt;&lt; std::setw(10) &lt;&lt; _sys-&gt;time</div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; force.output_total()</div><div class="line">&lt;&lt; std::setw(30) &lt;&lt; force.output_sensitivity_total(p) &lt;&lt; std::endl;</div><div class="line"></div><div class="line">solver.<a class="code" href="class_m_a_s_t_1_1_stabilized_first_order_newmark_transient_sensitivity_solver.html#a935bd7c8fb55b9b450f54db29ab6c522">sensitivity_solve</a>(assembly, p);</div></div><!-- fragment --><p> update time step counter </p><div class="fragment"><div class="line">            t_step++;</div><div class="line">        }</div><div class="line">        </div><div class="line">    }</div><div class="line">    </div><div class="line">    </div><div class="line">};</div></div><!-- fragment --> <h1><a class="anchor" id="flow_driver"></a>
Main function</h1>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>** argv)</div><div class="line">{</div></div><!-- fragment --><p> Initialize libMesh library. </p><div class="fragment"><div class="line">libMesh::LibMeshInit init(argc, argv);</div></div><!-- fragment --><p> initialize the wrapper to read input parameters. This will check if the executable parameters included a parameter of type <code>input=${filename}</code>. If included, then the input parameters will be read from this filename. Otherwise, the parameters will be read from the executable arguments. The wrapper uses default values for parameters if none are provided. </p><div class="fragment"><div class="line">MAST::Examples::GetPotWrapper</div><div class="line">input(argc, argv, <span class="stringliteral">&quot;input&quot;</span>);</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span></div><div class="line">analysis    = input(<span class="stringliteral">&quot;if_analysis&quot;</span>, <span class="stringliteral">&quot;whether or not to perform analysis&quot;</span>, <span class="keyword">true</span>),</div><div class="line">sensitivity = input(<span class="stringliteral">&quot;if_sensitivity&quot;</span>, <span class="stringliteral">&quot;whether or not to perform sensitivity analysis&quot;</span>, <span class="keyword">false</span>),</div><div class="line">stabilized  = input(<span class="stringliteral">&quot;if_stabilized_sensitivity&quot;</span>, <span class="stringliteral">&quot;flag to use standard or stabilized sensitivity analysis&quot;</span>, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">FlowAnalysis flow(init, input);</div><div class="line"><span class="keywordflow">if</span> (analysis)</div><div class="line">    flow.compute_flow();</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (sensitivity) {</div><div class="line"><a class="code" href="class_m_a_s_t_1_1_parameter.html">MAST::Parameter</a> p(<span class="stringliteral">&quot;dummy&quot;</span>, 0.);</div><div class="line">    <span class="keywordflow">if</span> (!stabilized)</div><div class="line">        flow.compute_transient_sensitivity(p);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        flow.compute_transient_stabilized_sensitivity(p);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="TutorialsPage.html">Tutorials for MAST</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
